---
import type { CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import NotebookLayout from '../../components/NotebookLayout.astro';
import { getCollection } from 'astro:content';
import { getNotesByNotebook } from '../../utils/notebooks';

export async function getStaticPaths() {
  const notebooks = await getCollection('notebooks');
  return notebooks.map((notebook) => ({
    params: { slug: notebook.slug },
    props: { notebook },
  }));
}

const { notebook } = Astro.props as { notebook: CollectionEntry<'notebooks'> };
const notes = await getNotesByNotebook(notebook.slug);
const firstNote = notes[0] ?? null;
const { title, description } = notebook.data;
const pageTitle = firstNote
  ? `${firstNote.data.title} - ${title}`
  : `${title} - KeGoLog`;
---

<Layout title={pageTitle} description={description || undefined}>
  <NotebookLayout
    notebook={notebook}
    notebookSlug={notebook.slug}
    notes={notes}
    noteSlug={firstNote?.slug ?? null}
    noteEntry={firstNote}
  />
</Layout>
