
---
title: 2.3 - ç®­å¤´å‡½æ•°ã€è§£æ„èµ‹å€¼ã€æ‰©å±•è¿ç®—ç¬¦
aiNotebook: js-interview
date: 2026-02-03
tags: ['JavaScript', 'é¢è¯•']
excerpt: ç®­å¤´å‡½æ•°ã€è§£æ„èµ‹å€¼ã€æ‰©å±•è¿ç®—ç¬¦
order: 9
---

# JavaScript ES6 æ ¸å¿ƒç‰¹æ€§æ·±åº¦è§£æ

> ç®­å¤´å‡½æ•°ã€è§£æ„èµ‹å€¼ã€æ‰©å±•è¿ç®—ç¬¦ â€”â€” ä»åŸç†åˆ°å®æˆ˜

## ç›®å½•

- [ä¸€ã€ç®­å¤´å‡½æ•° (Arrow Function)](#ä¸€ç®­å¤´å‡½æ•°-arrow-function)
  - [1.1 åŸºæœ¬è¯­æ³•ä¸ä½¿ç”¨](#11-åŸºæœ¬è¯­æ³•ä¸ä½¿ç”¨)
  - [1.2 this ç»‘å®šæœºåˆ¶æ·±åº¦å‰–æ](#12-this-ç»‘å®šæœºåˆ¶æ·±åº¦å‰–æ)
  - [1.3 ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°çš„æœ¬è´¨åŒºåˆ«](#13-ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°çš„æœ¬è´¨åŒºåˆ«)
  - [1.4 ä½¿ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ](#14-ä½¿ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ)
  - [1.5 å¸¸è§é™·é˜±ä¸é¢è¯•é¢˜](#15-å¸¸è§é™·é˜±ä¸é¢è¯•é¢˜)
- [äºŒã€è§£æ„èµ‹å€¼ (Destructuring)](#äºŒè§£æ„èµ‹å€¼-destructuring)
  - [2.1 æ•°ç»„è§£æ„åŸç†](#21-æ•°ç»„è§£æ„åŸç†)
  - [2.2 å¯¹è±¡è§£æ„åŸç†](#22-å¯¹è±¡è§£æ„åŸç†)
  - [2.3 é»˜è®¤å€¼æœºåˆ¶](#23-é»˜è®¤å€¼æœºåˆ¶)
  - [2.4 é«˜çº§åº”ç”¨åœºæ™¯](#24-é«˜çº§åº”ç”¨åœºæ™¯)
  - [2.5 æ€§èƒ½ä¸è¾¹ç•Œæƒ…å†µ](#25-æ€§èƒ½ä¸è¾¹ç•Œæƒ…å†µ)
- [ä¸‰ã€æ‰©å±•è¿ç®—ç¬¦ (Spread/Rest)](#ä¸‰æ‰©å±•è¿ç®—ç¬¦-spreadrest)
  - [3.1 å±•å¼€è¿ç®—ç¬¦åŸç†](#31-å±•å¼€è¿ç®—ç¬¦åŸç†)
  - [3.2 å‰©ä½™å‚æ•°åŸç†](#32-å‰©ä½™å‚æ•°åŸç†)
  - [3.3 æ·±æ‹·è´ä¸æµ…æ‹·è´](#33-æ·±æ‹·è´ä¸æµ…æ‹·è´)
  - [3.4 å®æˆ˜åº”ç”¨åœºæ™¯](#34-å®æˆ˜åº”ç”¨åœºæ™¯)
  - [3.5 æ€§èƒ½è€ƒé‡](#35-æ€§èƒ½è€ƒé‡)
- [å››ã€ç»¼åˆå®æˆ˜æ¡ˆä¾‹](#å››ç»¼åˆå®æˆ˜æ¡ˆä¾‹)
- [äº”ã€é¢è¯•é«˜é¢‘é¢˜è§£æ](#äº”é¢è¯•é«˜é¢‘é¢˜è§£æ)

---

## ä¸€ã€ç®­å¤´å‡½æ•° (Arrow Function)

### 1.1 åŸºæœ¬è¯­æ³•ä¸ä½¿ç”¨

#### è¯­æ³•æ¼”è¿›

```javascript
// ä¼ ç»Ÿå‡½æ•°è¡¨è¾¾å¼
const add1 = function(a, b) {
  return a + b;
};

// ç®­å¤´å‡½æ•° - å®Œæ•´å½¢å¼
const add2 = (a, b) => {
  return a + b;
};

// ç®­å¤´å‡½æ•° - ç®€å†™(å•ä¸€è¡¨è¾¾å¼,è‡ªåŠ¨return)
const add3 = (a, b) => a + b;

// å•å‚æ•°å¯çœç•¥æ‹¬å·
const square = x => x * x;

// æ— å‚æ•°å¿…é¡»ä¿ç•™ç©ºæ‹¬å·
const getRandom = () => Math.random();

// è¿”å›å¯¹è±¡å­—é¢é‡éœ€è¦ç”¨æ‹¬å·åŒ…è£¹
const makeUser = (name, age) => ({ name, age });
```

#### è¯­æ³•ç³–æœ¬è´¨

ç®­å¤´å‡½æ•°çš„ç®€æ´è¯­æ³•èƒŒåæ˜¯ JavaScript å¼•æ“çš„è¯­æ³•ç³–è½¬æ¢:

```javascript
// æºä»£ç 
const multiply = (a, b) => a * b;

// å¼•æ“å®é™…æ‰§è¡Œé€»è¾‘(ç®€åŒ–ç†è§£)
const multiply = function(a, b) {
  // å…³é”®:è¯æ³•ä½œç”¨åŸŸç»‘å®š this
  const _this = this; // æ•è·å¤–å±‚ this
  return function(a, b) {
    return a * b;
  }.call(_this, a, b);
};
```

---

### 1.2 this ç»‘å®šæœºåˆ¶æ·±åº¦å‰–æ

#### æ ¸å¿ƒåŸç†:è¯æ³•ä½œç”¨åŸŸ (Lexical Scoping)

**ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ `this`**,å®ƒä¼šæ•è·å®šä¹‰æ—¶æ‰€åœ¨ä¸Šä¸‹æ–‡çš„ `this` å€¼ã€‚

```javascript
// ç¤ºä¾‹ 1: å¯¹æ¯”ä¼ ç»Ÿå‡½æ•°ä¸ç®­å¤´å‡½æ•°
const obj = {
  name: 'MyObject',
  
  // ä¼ ç»Ÿæ–¹æ³•
  regularMethod: function() {
    console.log('Regular:', this.name); // this æŒ‡å‘ obj
    
    setTimeout(function() {
      console.log('Callback Regular:', this.name); // this æŒ‡å‘ window/global
    }, 100);
  },
  
  // ç®­å¤´å‡½æ•°æ–¹æ³•
  arrowMethod: function() {
    console.log('Arrow Parent:', this.name); // this æŒ‡å‘ obj
    
    setTimeout(() => {
      console.log('Callback Arrow:', this.name); // this ä»æŒ‡å‘ obj (è¯æ³•æ•è·)
    }, 100);
  }
};

obj.regularMethod();
// è¾“å‡º: Regular: MyObject
//      Callback Regular: undefined

obj.arrowMethod();
// è¾“å‡º: Arrow Parent: MyObject
//      Callback Arrow: MyObject
```

#### åŸç†å›¾è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¨å±€ä½œç”¨åŸŸ (Global Scope)               â”‚
â”‚  this = window/global                   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  obj å¯¹è±¡                          â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚  regularMethod() {                â”‚ â”‚
â”‚  â”‚    this = obj âœ“                   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚    setTimeout(function() {        â”‚ â”‚
â”‚  â”‚      this = window âœ—              â”‚ â”‚
â”‚  â”‚    })                              â”‚ â”‚
â”‚  â”‚  }                                 â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚  arrowMethod() {                  â”‚ â”‚
â”‚  â”‚    this = obj âœ“                   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚    setTimeout(() => {             â”‚ â”‚
â”‚  â”‚      this = obj âœ“ (è¯æ³•ç»§æ‰¿)      â”‚ â”‚
â”‚  â”‚    })                              â”‚ â”‚
â”‚  â”‚  }                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### çœŸå®å·¥ä½œåœºæ™¯

```javascript
// React ç±»ç»„ä»¶ä¸­çš„äº‹ä»¶å¤„ç†
class TodoList extends React.Component {
  state = { todos: [] };
  
  // æ–¹æ¡ˆ1: ç®­å¤´å‡½æ•°è‡ªåŠ¨ç»‘å®š this
  addTodo = (text) => {
    this.setState({ 
      todos: [...this.state.todos, text] 
    });
  };
  
  // æ–¹æ¡ˆ2: ä¼ ç»Ÿæ–¹æ³•éœ€è¦æ‰‹åŠ¨ç»‘å®š
  addTodoTraditional(text) {
    this.setState({ 
      todos: [...this.state.todos, text] 
    });
  }
  
  componentDidMount() {
    // ç®­å¤´å‡½æ•°:æ— éœ€ bind
    fetchTodos().then(this.addTodo);
    
    // ä¼ ç»Ÿå‡½æ•°:éœ€è¦ bind
    fetchTodos().then(this.addTodoTraditional.bind(this));
  }
}
```

---

### 1.3 ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°çš„æœ¬è´¨åŒºåˆ«

#### å¯¹æ¯”è¡¨

| ç‰¹æ€§ | æ™®é€šå‡½æ•° | ç®­å¤´å‡½æ•° |
|-----|---------|---------|
| `this` ç»‘å®š | åŠ¨æ€,è°ƒç”¨æ—¶å†³å®š | è¯æ³•,å®šä¹‰æ—¶æ•è· |
| `arguments` å¯¹è±¡ | âœ… æœ‰ | âŒ æ—  |
| `new` æ„é€ è°ƒç”¨ | âœ… å¯ä»¥ | âŒ ä¸å¯ä»¥ |
| `prototype` å±æ€§ | âœ… æœ‰ | âŒ æ—  |
| `super` å…³é”®å­— | âœ… å¯ç”¨ | âŒ ä¸å¯ç”¨ |
| æ–¹æ³•ç®€å†™ | æ”¯æŒ | æ”¯æŒ |
| Generator | âœ… å¯ä»¥ | âŒ ä¸å¯ä»¥ |

#### æ·±åº¦å¯¹æ¯”

```javascript
// 1. arguments å¯¹è±¡
function regularFunc() {
  console.log(arguments); // [1, 2, 3]
}
regularFunc(1, 2, 3);

const arrowFunc = () => {
  console.log(arguments); // ReferenceError: arguments is not defined
};
// è§£å†³æ–¹æ¡ˆ:ä½¿ç”¨å‰©ä½™å‚æ•°
const arrowWithRest = (...args) => {
  console.log(args); // [1, 2, 3]
};
arrowWithRest(1, 2, 3);

// 2. æ„é€ å‡½æ•°
function Person(name) {
  this.name = name;
}
const p1 = new Person('Alice'); // âœ… æ­£å¸¸

const PersonArrow = (name) => {
  this.name = name;
};
const p2 = new PersonArrow('Bob'); // âŒ TypeError: PersonArrow is not a constructor

// 3. prototype
console.log(Person.prototype); // { constructor: Æ’ }
console.log(PersonArrow.prototype); // undefined

// 4. call/apply/bind æ— æ•ˆ
const obj1 = { value: 1 };
const obj2 = { value: 2 };

const regular = function() { return this.value; };
console.log(regular.call(obj1)); // 1
console.log(regular.call(obj2)); // 2

const arrow = () => this.value;
console.log(arrow.call(obj1)); // undefined (this å·²å›ºå®š)
console.log(arrow.call(obj2)); // undefined
```

---

### 1.4 ä½¿ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ

#### âœ… é€‚åˆä½¿ç”¨ç®­å¤´å‡½æ•°çš„åœºæ™¯

```javascript
// 1. æ•°ç»„æ–¹æ³•å›è°ƒ
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map(n => n * 2);
const sum = numbers.reduce((acc, n) => acc + n, 0);
const evens = numbers.filter(n => n % 2 === 0);

// 2. Promise é“¾
fetch('/api/user')
  .then(res => res.json())
  .then(data => data.user)
  .then(user => console.log(user.name))
  .catch(err => console.error(err));

// 3. å®šæ—¶å™¨/äº‹ä»¶ç›‘å¬
class Counter {
  count = 0;
  
  start() {
    setInterval(() => {
      this.count++; // this æŒ‡å‘ Counter å®ä¾‹
      console.log(this.count);
    }, 1000);
  }
}

// 4. å‡½æ•°å¼ç¼–ç¨‹
const pipe = (...fns) => x => fns.reduce((v, f) => f(v), x);
const add10 = x => x + 10;
const multiply2 = x => x * 2;
const result = pipe(add10, multiply2)(5); // (5+10)*2 = 30
```

#### âŒ ä¸é€‚åˆä½¿ç”¨ç®­å¤´å‡½æ•°çš„åœºæ™¯

```javascript
// 1. å¯¹è±¡æ–¹æ³•(éœ€è¦åŠ¨æ€ this)
const calculator = {
  value: 0,
  
  // âŒ é”™è¯¯:this æŒ‡å‘å¤–å±‚ä½œç”¨åŸŸ
  addArrow: (n) => {
    this.value += n; // this !== calculator
  },
  
  // âœ… æ­£ç¡®
  add(n) {
    this.value += n;
  }
};

// 2. éœ€è¦ arguments çš„å‡½æ•°
// âŒ é”™è¯¯
const sum = () => {
  return Array.from(arguments).reduce((a, b) => a + b);
};

// âœ… æ­£ç¡®
function sum() {
  return Array.from(arguments).reduce((a, b) => a + b);
}
// æˆ–ä½¿ç”¨å‰©ä½™å‚æ•°
const sum2 = (...nums) => nums.reduce((a, b) => a + b);

// 3. åŸå‹æ–¹æ³•
// âŒ é”™è¯¯
Person.prototype.sayHello = () => {
  console.log(`Hello, ${this.name}`); // this ä¸æ˜¯å®ä¾‹
};

// âœ… æ­£ç¡®
Person.prototype.sayHello = function() {
  console.log(`Hello, ${this.name}`);
};

// 4. åŠ¨æ€ä¸Šä¸‹æ–‡(äº‹ä»¶å¤„ç†å™¨)
// âŒ é”™è¯¯
button.addEventListener('click', () => {
  this.classList.toggle('active'); // this ä¸æ˜¯ button
});

// âœ… æ­£ç¡®
button.addEventListener('click', function() {
  this.classList.toggle('active');
});
```

---

### 1.5 å¸¸è§é™·é˜±ä¸é¢è¯•é¢˜

#### é™·é˜± 1: å¯¹è±¡æ–¹æ³•ä¸­çš„ç®­å¤´å‡½æ•°

```javascript
const obj = {
  name: 'Object',
  
  // é™·é˜±:çœ‹ä¼¼æ˜¯æ–¹æ³•,å®é™…æ˜¯å±æ€§
  getName: () => {
    console.log(this.name); // this æŒ‡å‘å®šä¹‰æ—¶çš„å¤–å±‚ä½œç”¨åŸŸ
  }
};

obj.getName(); // undefined (ä¸¥æ ¼æ¨¡å¼) æˆ– window.name (éä¸¥æ ¼æ¨¡å¼)

// æ­£ç¡®ç†è§£:ç­‰ä»·äº
const obj = {
  name: 'Object'
};
obj.getName = () => {
  console.log(this.name); // this åœ¨å¯¹è±¡å¤–éƒ¨å®šä¹‰
};
```

#### é™·é˜± 2: æ„é€ å‡½æ•°ä¸­çš„ç®­å¤´å‡½æ•°

```javascript
function Person(name) {
  this.name = name;
  
  // âœ… å®ä¾‹æ–¹æ³•(æ¯ä¸ªå®ä¾‹ç‹¬ç«‹)
  this.sayHello = () => {
    console.log(`Hello, ${this.name}`);
  };
}

const p1 = new Person('Alice');
const p2 = new Person('Bob');

p1.sayHello(); // Hello, Alice
p2.sayHello(); // Hello, Bob

// æ³¨æ„:æ¯ä¸ªå®ä¾‹éƒ½åˆ›å»ºæ–°çš„å‡½æ•°
console.log(p1.sayHello === p2.sayHello); // false

// å¯¹æ¯”:åŸå‹æ–¹æ³•å…±äº«
Person.prototype.greet = function() {
  console.log(`Hi, ${this.name}`);
};
console.log(p1.greet === p2.greet); // true
```

#### é¢è¯•é¢˜ 1: ç»å…¸ this æŒ‡å‘

```javascript
const obj = {
  a: 1,
  foo: function() {
    console.log(this.a);
  },
  bar: () => {
    console.log(this.a);
  }
};

obj.foo(); // è¾“å‡º: 1 (this = obj)
obj.bar(); // è¾“å‡º: undefined (this = å®šä¹‰æ—¶çš„å¤–å±‚,é€šå¸¸æ˜¯ window)

const foo = obj.foo;
const bar = obj.bar;

foo(); // è¾“å‡º: undefined (this = window)
bar(); // è¾“å‡º: undefined (this å·²å›ºå®šä¸ºå®šä¹‰æ—¶çš„å¤–å±‚)
```

#### é¢è¯•é¢˜ 2: ç®­å¤´å‡½æ•°åµŒå¥—

```javascript
const obj = {
  name: 'Outer',
  
  getNameGetter: function() {
    // å¤–å±‚æ˜¯æ™®é€šå‡½æ•°,this = obj
    return () => {
      // ç®­å¤´å‡½æ•°æ•è·å¤–å±‚ this
      console.log(this.name);
    };
  }
};

const getter = obj.getNameGetter();
getter(); // è¾“å‡º: Outer

// æ”¹å˜è°ƒç”¨æ–¹å¼
const getNameGetter = obj.getNameGetter;
const getter2 = getNameGetter(); // æ­¤æ—¶å¤–å±‚ this = window
getter2(); // è¾“å‡º: undefined
```

#### é¢è¯•é¢˜ 3: React ä¸­çš„å®é™…åº”ç”¨

```javascript
class TodoItem extends React.Component {
  // æ–¹æ¡ˆ1: æ„é€ å‡½æ•° bind
  constructor(props) {
    super(props);
    this.handleClick1 = this.handleClick1.bind(this);
  }
  
  handleClick1() {
    console.log(this.props.id);
  }
  
  // æ–¹æ¡ˆ2: ç®­å¤´å‡½æ•°ç±»å±æ€§(æ¨è)
  handleClick2 = () => {
    console.log(this.props.id);
  };
  
  // æ–¹æ¡ˆ3: å†…è”ç®­å¤´å‡½æ•°(ä¸æ¨è,æ¯æ¬¡ render åˆ›å»ºæ–°å‡½æ•°)
  render() {
    return (
      <div>
        <button onClick={this.handleClick1}>æ–¹æ¡ˆ1</button>
        <button onClick={this.handleClick2}>æ–¹æ¡ˆ2</button>
        <button onClick={() => this.handleClick1()}>æ–¹æ¡ˆ3</button>
      </div>
    );
  }
}

// æ€§èƒ½å¯¹æ¯”:
// æ–¹æ¡ˆ1å’Œ2: å‡½æ•°å¼•ç”¨ä¸å˜,å­ç»„ä»¶å¯ç”¨ React.memo ä¼˜åŒ–
// æ–¹æ¡ˆ3: æ¯æ¬¡ render åˆ›å»ºæ–°å‡½æ•°,å¯¼è‡´å­ç»„ä»¶æ— æ„ä¹‰ re-render
```

---

## äºŒã€è§£æ„èµ‹å€¼ (Destructuring)

### 2.1 æ•°ç»„è§£æ„åŸç†

#### åº•å±‚æœºåˆ¶: Iterator æ¥å£

æ•°ç»„è§£æ„æœ¬è´¨æ˜¯è°ƒç”¨ç›®æ ‡çš„ **Iterator æ¥å£** (`Symbol.iterator`)ã€‚

```javascript
// è§£æ„è¯­æ³•
const [a, b, c] = [1, 2, 3];

// ç­‰ä»·äº(ç®€åŒ–ç†è§£)
const _arr = [1, 2, 3];
const _iterator = _arr[Symbol.iterator]();
const a = _iterator.next().value; // 1
const b = _iterator.next().value; // 2
const c = _iterator.next().value; // 3
```

#### åŸºæœ¬è¯­æ³•

```javascript
// 1. åŸºç¡€è§£æ„
const [a, b] = [1, 2];
console.log(a, b); // 1 2

// 2. è·³è¿‡å…ƒç´ 
const [first, , third] = [1, 2, 3];
console.log(first, third); // 1 3

// 3. å‰©ä½™å…ƒç´ 
const [head, ...tail] = [1, 2, 3, 4];
console.log(head); // 1
console.log(tail); // [2, 3, 4]

// 4. åµŒå¥—è§£æ„
const [a, [b, c]] = [1, [2, 3]];
console.log(a, b, c); // 1 2 3

// 5. é»˜è®¤å€¼
const [x = 1, y = 2] = [10];
console.log(x, y); // 10 2
```

#### Iterator åè®®éªŒè¯

```javascript
// ä»»ä½•å®ç°äº† Iterator æ¥å£çš„å¯¹è±¡éƒ½å¯ä»¥è§£æ„
const str = 'hello';
const [h, e, l1, l2, o] = str;
console.log(h, e, l1, l2, o); // h e l l o

// Set ä¹Ÿå¯ä»¥è§£æ„
const set = new Set([1, 2, 3]);
const [s1, s2, s3] = set;
console.log(s1, s2, s3); // 1 2 3

// Generator å‡½æ•°ä¹Ÿå¯ä»¥
function* gen() {
  yield 1;
  yield 2;
  yield 3;
}
const [g1, g2, g3] = gen();
console.log(g1, g2, g3); // 1 2 3

// æ™®é€šå¯¹è±¡ä¸å¯ä»¥(æ²¡æœ‰ Iterator)
const [err] = { a: 1 }; // TypeError: object is not iterable
```

---

### 2.2 å¯¹è±¡è§£æ„åŸç†

#### åº•å±‚æœºåˆ¶: å±æ€§è®¿é—®

å¯¹è±¡è§£æ„æœ¬è´¨æ˜¯ **å±æ€§æŸ¥æ‰¾å’Œèµ‹å€¼**ã€‚

```javascript
// è§£æ„è¯­æ³•
const { name, age } = { name: 'Alice', age: 25 };

// ç­‰ä»·äº
const _obj = { name: 'Alice', age: 25 };
const name = _obj.name;
const age = _obj.age;
```

#### åŸºæœ¬è¯­æ³•

```javascript
// 1. åŸºç¡€è§£æ„
const { name, age } = { name: 'Alice', age: 25 };
console.log(name, age); // Alice 25

// 2. é‡å‘½å
const { name: userName, age: userAge } = { name: 'Bob', age: 30 };
console.log(userName, userAge); // Bob 30

// 3. é»˜è®¤å€¼
const { x = 10, y = 20 } = { x: 5 };
console.log(x, y); // 5 20

// 4. åµŒå¥—è§£æ„
const { user: { name, address: { city } } } = {
  user: {
    name: 'Charlie',
    address: { city: 'Beijing' }
  }
};
console.log(name, city); // Charlie Beijing

// 5. å‰©ä½™å±æ€§
const { a, b, ...rest } = { a: 1, b: 2, c: 3, d: 4 };
console.log(a, b, rest); // 1 2 { c: 3, d: 4 }
```

#### åŸå‹é“¾æŸ¥æ‰¾

```javascript
const parent = { inherited: 'yes' };
const child = Object.create(parent);
child.own = 'mine';

const { own, inherited } = child;
console.log(own, inherited); // mine yes (ä¼šæŸ¥æ‰¾åŸå‹é“¾)
```

---

### 2.3 é»˜è®¤å€¼æœºåˆ¶

#### è§¦å‘æ¡ä»¶: `undefined`

```javascript
// åªæœ‰ä¸¥æ ¼ç­‰äº undefined æ‰ä½¿ç”¨é»˜è®¤å€¼
const [a = 1] = [undefined];
console.log(a); // 1

const [b = 1] = [null];
console.log(b); // null (ä¸è§¦å‘é»˜è®¤å€¼)

const [c = 1] = [0];
console.log(c); // 0

const [d = 1] = [false];
console.log(d); // false

const [e = 1] = [''];
console.log(e); // ''
```

#### é»˜è®¤å€¼è¡¨è¾¾å¼æƒ°æ€§æ±‚å€¼

```javascript
let count = 0;

function getDefault() {
  count++;
  return 'default';
}

// æ¡ˆä¾‹1: æœ‰å€¼,ä¸è°ƒç”¨å‡½æ•°
const [a = getDefault()] = ['value'];
console.log(a); // 'value'
console.log(count); // 0 (å‡½æ•°æœªè°ƒç”¨)

// æ¡ˆä¾‹2: æ— å€¼,è°ƒç”¨å‡½æ•°
const [b = getDefault()] = [];
console.log(b); // 'default'
console.log(count); // 1 (å‡½æ•°è¢«è°ƒç”¨)
```

#### å¯¹è±¡è§£æ„é»˜è®¤å€¼é™·é˜±

```javascript
// é™·é˜±:é‡å‘½å + é»˜è®¤å€¼è¯­æ³•
const { name: userName = 'Anonymous' } = {};
console.log(userName); // Anonymous
console.log(name); // ReferenceError: name is not defined

// ç†è§£:
// 1. name æ˜¯å±æ€§å
// 2. userName æ˜¯å˜é‡å
// 3. 'Anonymous' æ˜¯é»˜è®¤å€¼
```

---

### 2.4 é«˜çº§åº”ç”¨åœºæ™¯

#### åœºæ™¯ 1: å‡½æ•°å‚æ•°è§£æ„

```javascript
// ä¼ ç»Ÿå†™æ³•
function createUser(options) {
  const name = options.name || 'Anonymous';
  const age = options.age || 18;
  const role = options.role || 'user';
  // ...
}

// è§£æ„å†™æ³•(ç®€æ´ + è‡ªæ–‡æ¡£)
function createUser({ 
  name = 'Anonymous', 
  age = 18, 
  role = 'user' 
} = {}) {
  console.log(name, age, role);
}

createUser({ name: 'Alice', age: 25 }); // Alice 25 user
createUser(); // Anonymous 18 user (æ³¨æ„æœ€åçš„ = {})
```

#### åœºæ™¯ 2: è¿”å›å¤šä¸ªå€¼

```javascript
// ä¼ ç»Ÿ:è¿”å›å¯¹è±¡
function getStats(arr) {
  return {
    min: Math.min(...arr),
    max: Math.max(...arr),
    avg: arr.reduce((a, b) => a + b) / arr.length
  };
}

const stats = getStats([1, 2, 3, 4, 5]);
console.log(stats.min, stats.max, stats.avg);

// è§£æ„:æ›´ç®€æ´
function getStats(arr) {
  return {
    min: Math.min(...arr),
    max: Math.max(...arr),
    avg: arr.reduce((a, b) => a + b) / arr.length
  };
}

const { min, max, avg } = getStats([1, 2, 3, 4, 5]);
console.log(min, max, avg);
```

#### åœºæ™¯ 3: äº¤æ¢å˜é‡

```javascript
// ä¼ ç»Ÿå†™æ³•
let a = 1, b = 2;
let temp = a;
a = b;
b = temp;

// è§£æ„å†™æ³•
let x = 1, y = 2;
[x, y] = [y, x];
console.log(x, y); // 2 1

// åŸç†(ç®€åŒ–)
let x = 1, y = 2;
let _temp = [y, x]; // [2, 1]
x = _temp[0];
y = _temp[1];
```

#### åœºæ™¯ 4: æå– JSON æ•°æ®

```javascript
const response = {
  code: 200,
  data: {
    user: {
      id: 1,
      name: 'Alice',
      email: 'alice@example.com'
    },
    token: 'xxx'
  },
  message: 'success'
};

// æ·±åº¦è§£æ„
const {
  code,
  data: {
    user: { id, name, email },
    token
  },
  message
} = response;

console.log(id, name, email, token); // 1 Alice alice@example.com xxx
```

#### åœºæ™¯ 5: React Hooks

```javascript
// useState è§£æ„
const [count, setCount] = useState(0);

// useReducer è§£æ„
const [state, dispatch] = useReducer(reducer, initialState);

// è‡ªå®šä¹‰ Hook
function useUser(userId) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    fetchUser(userId).then(setUser).finally(() => setLoading(false));
  }, [userId]);
  
  return { user, loading };
}

// ä½¿ç”¨æ—¶è§£æ„
const { user, loading } = useUser(1);
```

---

### 2.5 æ€§èƒ½ä¸è¾¹ç•Œæƒ…å†µ

#### æ€§èƒ½è€ƒé‡

```javascript
// è§£æ„ä¸å½±å“æ€§èƒ½(ç¼–è¯‘æ—¶è½¬æ¢)
const { a, b, c } = obj; // ä¸ä¸‹é¢ç­‰ä»·
const a = obj.a;
const b = obj.b;
const c = obj.c;

// ä½†åµŒå¥—è§£æ„å¯èƒ½å¯¼è‡´å¤šæ¬¡å±æ€§è®¿é—®
const {
  user: {
    profile: {
      address: {
        city
      }
    }
  }
} = data;

// ç­‰ä»·äº
const city = data.user.profile.address.city; // 4 æ¬¡å±æ€§è®¿é—®
```

#### è¾¹ç•Œæƒ…å†µ

```javascript
// 1. null/undefined è§£æ„æŠ¥é”™
const { a } = null; // TypeError: Cannot destructure property 'a' of 'null'
const [b] = undefined; // TypeError: undefined is not iterable

// å®‰å…¨è§£æ„
const { a } = obj || {};
const [b] = arr || [];

// 2. è§£æ„ä¸å­˜åœ¨çš„å±æ€§
const { nonexistent } = { foo: 'bar' };
console.log(nonexistent); // undefined (ä¸æŠ¥é”™)

// 3. è®¡ç®—å±æ€§åè§£æ„
const key = 'dynamicKey';
const { [key]: value } = { dynamicKey: 'value' };
console.log(value); // 'value'

// 4. æ•°ç»„è¶Šç•Œ
const [a, b, c, d] = [1, 2];
console.log(a, b, c, d); // 1 2 undefined undefined
```

---

## ä¸‰ã€æ‰©å±•è¿ç®—ç¬¦ (Spread/Rest)

### 3.1 å±•å¼€è¿ç®—ç¬¦åŸç†

#### åº•å±‚æœºåˆ¶

```javascript
// æ•°ç»„å±•å¼€:è°ƒç”¨ Iterator æ¥å£
const arr1 = [1, 2, 3];
const arr2 = [...arr1, 4, 5];

// ç­‰ä»·äº
const arr2 = [];
for (const item of arr1) {
  arr2.push(item);
}
arr2.push(4, 5);

// å¯¹è±¡å±•å¼€:è°ƒç”¨ Object.assign(æµ…æ‹·è´)
const obj1 = { a: 1, b: 2 };
const obj2 = { ...obj1, c: 3 };

// ç±»ä¼¼äº(ä½†ä¸å®Œå…¨ç­‰ä»·)
const obj2 = Object.assign({}, obj1, { c: 3 });
```

#### æ•°ç»„å±•å¼€åº”ç”¨

```javascript
// 1. åˆå¹¶æ•°ç»„
const arr1 = [1, 2];
const arr2 = [3, 4];
const combined = [...arr1, ...arr2];
console.log(combined); // [1, 2, 3, 4]

// ä¼ ç»Ÿæ–¹æ³•å¯¹æ¯”
const combined2 = arr1.concat(arr2);

// 2. æ•°ç»„å…‹éš†(æµ…æ‹·è´)
const original = [1, 2, 3];
const cloned = [...original];
cloned[0] = 999;
console.log(original); // [1, 2, 3] (ä¸å—å½±å“)

// 3. ç±»æ•°ç»„è½¬æ•°ç»„
const divs = document.querySelectorAll('div');
const divsArray = [...divs];

// 4. å­—ç¬¦ä¸²è½¬æ•°ç»„(æ­£ç¡®å¤„ç† Unicode)
const str = 'ğ’³ğ’´ğ’µ';
console.log([...str]); // ['ğ’³', 'ğ’´', 'ğ’µ']
console.log(str.split('')); // é”™è¯¯è¾“å‡º(ä¼šæ‹†åˆ†ä»£ç†å¯¹)

// 5. ä¼ é€’å‡½æ•°å‚æ•°
const numbers = [1, 5, 3, 9, 2];
console.log(Math.max(...numbers)); // 9

// ä¼ ç»Ÿæ–¹æ³•
console.log(Math.max.apply(null, numbers));
```

#### å¯¹è±¡å±•å¼€åº”ç”¨

```javascript
// 1. å¯¹è±¡åˆå¹¶
const defaults = { theme: 'light', lang: 'en' };
const userSettings = { theme: 'dark' };
const finalSettings = { ...defaults, ...userSettings };
console.log(finalSettings); // { theme: 'dark', lang: 'en' }

// æ³¨æ„:åé¢çš„è¦†ç›–å‰é¢çš„
const obj = { ...{ a: 1 }, ...{ a: 2 } };
console.log(obj.a); // 2

// 2. æ·»åŠ /ä¿®æ”¹å±æ€§
const user = { name: 'Alice', age: 25 };
const updatedUser = { ...user, age: 26, city: 'Beijing' };
console.log(updatedUser); // { name: 'Alice', age: 26, city: 'Beijing' }

// 3. æ¡ä»¶å±æ€§
const includeEmail = true;
const user = {
  name: 'Bob',
  ...(includeEmail && { email: 'bob@example.com' })
};
console.log(user); // { name: 'Bob', email: 'bob@example.com' }

// 4. ç§»é™¤å±æ€§
const { password, ...publicUser } = { 
  id: 1, 
  name: 'Alice', 
  password: 'secret' 
};
console.log(publicUser); // { id: 1, name: 'Alice' }
```

---

### 3.2 å‰©ä½™å‚æ•°åŸç†

#### Rest è¯­æ³•

```javascript
// å‡½æ•°å‰©ä½™å‚æ•°
function sum(...numbers) {
  return numbers.reduce((a, b) => a + b, 0);
}
console.log(sum(1, 2, 3, 4)); // 10

// ç­‰ä»·äº(ä½¿ç”¨ arguments)
function sum() {
  const numbers = Array.from(arguments);
  return numbers.reduce((a, b) => a + b, 0);
}

// æ•°ç»„å‰©ä½™å…ƒç´ 
const [first, ...rest] = [1, 2, 3, 4];
console.log(first); // 1
console.log(rest); // [2, 3, 4]

// å¯¹è±¡å‰©ä½™å±æ€§
const { a, b, ...others } = { a: 1, b: 2, c: 3, d: 4 };
console.log(a, b); // 1 2
console.log(others); // { c: 3, d: 4 }
```

#### Rest vs Arguments

```javascript
// arguments é—®é¢˜
function traditional() {
  console.log(arguments); // ç±»æ•°ç»„å¯¹è±¡
  console.log(Array.isArray(arguments)); // false
  
  // æ— æ³•ä½¿ç”¨æ•°ç»„æ–¹æ³•
  // arguments.map(...) // TypeError
  
  // ç®­å¤´å‡½æ•°æ—  arguments
  const inner = () => {
    console.log(arguments); // ReferenceError
  };
}

// Rest å‚æ•°ä¼˜åŠ¿
function modern(...args) {
  console.log(args); // çœŸæ•°ç»„
  console.log(Array.isArray(args)); // true
  
  // å¯ä»¥ä½¿ç”¨æ•°ç»„æ–¹æ³•
  args.map(x => x * 2);
  
  // ç®­å¤´å‡½æ•°ä¹Ÿå¯ç”¨
  const inner = (...innerArgs) => {
    console.log(innerArgs);
  };
}

// Rest å‚æ•°å¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‚æ•°
function valid(a, b, ...rest) {} // âœ…
function invalid(...rest, a, b) {} // âŒ SyntaxError
```

---

### 3.3 æ·±æ‹·è´ä¸æµ…æ‹·è´

#### æµ…æ‹·è´é™·é˜±

```javascript
// æ‰©å±•è¿ç®—ç¬¦åªåšæµ…æ‹·è´
const original = {
  name: 'Alice',
  address: { city: 'Beijing' }
};

const shallow = { ...original };

// ä¿®æ”¹åµŒå¥—å¯¹è±¡
shallow.address.city = 'Shanghai';

console.log(original.address.city); // 'Shanghai' (è¢«å½±å“äº†!)
console.log(original === shallow); // false
console.log(original.address === shallow.address); // true (å…±äº«å¼•ç”¨)
```

#### æ·±æ‹·è´æ–¹æ¡ˆå¯¹æ¯”

```javascript
const data = {
  name: 'Alice',
  age: 25,
  hobbies: ['reading', 'coding'],
  address: {
    city: 'Beijing',
    district: { name: 'Chaoyang' }
  }
};

// 1. JSON æ–¹æ³•(æœ€ç®€å•,æœ‰å±€é™)
const copy1 = JSON.parse(JSON.stringify(data));
// é—®é¢˜:ä¸¢å¤±å‡½æ•°ã€undefinedã€Symbolã€å¾ªç¯å¼•ç”¨

// 2. é€’å½’æ‰‹å†™
function deepClone(obj, cache = new WeakMap()) {
  if (obj === null || typeof obj !== 'object') return obj;
  if (cache.has(obj)) return cache.get(obj); // å¤„ç†å¾ªç¯å¼•ç”¨
  
  const clone = Array.isArray(obj) ? [] : {};
  cache.set(obj, clone);
  
  for (const key in obj) {
    if (obj.hasOwnProperty(key)) {
      clone[key] = deepClone(obj[key], cache);
    }
  }
  
  return clone;
}

const copy2 = deepClone(data);

// 3. ç°ä»£æµè§ˆå™¨: structuredClone
const copy3 = structuredClone(data);
// ä¼˜ç‚¹:åŸç”Ÿã€æ€§èƒ½å¥½ã€æ”¯æŒå¾ªç¯å¼•ç”¨ã€Dateã€RegExpã€Mapã€Set ç­‰
// ç¼ºç‚¹:ä¸æ”¯æŒå‡½æ•°ã€Symbol

// 4. åº“æ–¹æ¡ˆ
// import _ from 'lodash';
// const copy4 = _.cloneDeep(data);
```

#### å®æˆ˜:ä¸å¯å˜æ›´æ–°

```javascript
// React/Redux ä¸­çš„çŠ¶æ€æ›´æ–°
const state = {
  user: {
    name: 'Alice',
    profile: {
      age: 25,
      city: 'Beijing'
    }
  },
  settings: { theme: 'light' }
};

// âŒ é”™è¯¯:ç›´æ¥ä¿®æ”¹(ä¼šå¯¼è‡´å¼•ç”¨ä¸å˜,ç»„ä»¶ä¸æ›´æ–°)
state.user.profile.age = 26;

// âœ… æ­£ç¡®:ä¸å¯å˜æ›´æ–°
const newState = {
  ...state,
  user: {
    ...state.user,
    profile: {
      ...state.user.profile,
      age: 26
    }
  }
};

// ä½¿ç”¨ Immer åº“ç®€åŒ–
// import produce from 'immer';
// const newState = produce(state, draft => {
//   draft.user.profile.age = 26;
// });
```

---

### 3.4 å®æˆ˜åº”ç”¨åœºæ™¯

#### åœºæ™¯ 1: æ•°ç»„å»é‡

```javascript
// æ–¹æ¡ˆ1: Set + å±•å¼€è¿ç®—ç¬¦
const arr = [1, 2, 2, 3, 3, 3, 4];
const unique = [...new Set(arr)];
console.log(unique); // [1, 2, 3, 4]

// æ–¹æ¡ˆ2: å¯¹è±¡å»é‡(å¤æ‚å¯¹è±¡)
const users = [
  { id: 1, name: 'Alice' },
  { id: 2, name: 'Bob' },
  { id: 1, name: 'Alice' }
];

const uniqueUsers = [
  ...new Map(users.map(u => [u.id, u])).values()
];
console.log(uniqueUsers);
// [{ id: 1, name: 'Alice' }, { id: 2, name: 'Bob' }]
```

#### åœºæ™¯ 2: æ¡ä»¶æ¸²æŸ“å±æ€§

```javascript
// React ç»„ä»¶
function Button({ 
  onClick, 
  disabled = false, 
  loading = false,
  type = 'button'
}) {
  return (
    <button
      type={type}
      onClick={onClick}
      {...(disabled && { disabled: true })}
      {...(loading && { 'aria-busy': true })}
      className={`btn ${loading ? 'btn-loading' : ''}`}
    >
      {loading ? 'Loading...' : 'Submit'}
    </button>
  );
}
```

#### åœºæ™¯ 3: åˆå¹¶é…ç½®

```javascript
// é»˜è®¤é…ç½®
const defaultConfig = {
  timeout: 5000,
  headers: {
    'Content-Type': 'application/json'
  },
  retries: 3
};

// ç”¨æˆ·é…ç½®
const userConfig = {
  timeout: 10000,
  headers: {
    'Authorization': 'Bearer token'
  }
};

// åˆå¹¶(æ³¨æ„:åµŒå¥—å¯¹è±¡éœ€è¦æ·±åº¦åˆå¹¶)
const config = {
  ...defaultConfig,
  ...userConfig,
  headers: {
    ...defaultConfig.headers,
    ...userConfig.headers
  }
};

console.log(config);
// {
//   timeout: 10000,
//   headers: {
//     'Content-Type': 'application/json',
//     'Authorization': 'Bearer token'
//   },
//   retries: 3
// }
```

#### åœºæ™¯ 4: å‡½æ•°æŸ¯é‡ŒåŒ–

```javascript
// ä½¿ç”¨å‰©ä½™å‚æ•°å®ç°é€šç”¨æŸ¯é‡ŒåŒ–
function curry(fn) {
  return function curried(...args) {
    if (args.length >= fn.length) {
      return fn.apply(this, args);
    } else {
      return function(...nextArgs) {
        return curried.apply(this, [...args, ...nextArgs]);
      };
    }
  };
}

// ä½¿ç”¨ç¤ºä¾‹
function add(a, b, c) {
  return a + b + c;
}

const curriedAdd = curry(add);
console.log(curriedAdd(1)(2)(3)); // 6
console.log(curriedAdd(1, 2)(3)); // 6
console.log(curriedAdd(1)(2, 3)); // 6
```

#### åœºæ™¯ 5: æ•°ç»„åˆ†ç»„

```javascript
// æŒ‰å±æ€§åˆ†ç»„
function groupBy(arr, key) {
  return arr.reduce((groups, item) => {
    const group = item[key];
    return {
      ...groups,
      [group]: [...(groups[group] || []), item]
    };
  }, {});
}

const users = [
  { name: 'Alice', role: 'admin' },
  { name: 'Bob', role: 'user' },
  { name: 'Charlie', role: 'admin' }
];

const grouped = groupBy(users, 'role');
console.log(grouped);
// {
//   admin: [{ name: 'Alice', role: 'admin' }, { name: 'Charlie', role: 'admin' }],
//   user: [{ name: 'Bob', role: 'user' }]
// }
```

---

### 3.5 æ€§èƒ½è€ƒé‡

#### æ€§èƒ½å¯¹æ¯”

```javascript
// æµ‹è¯•æ•°æ®
const arr = Array.from({ length: 10000 }, (_, i) => i);

// æ–¹æ¡ˆ1: æ‰©å±•è¿ç®—ç¬¦
console.time('spread');
const copy1 = [...arr];
console.timeEnd('spread'); // ~0.1ms

// æ–¹æ¡ˆ2: Array.from
console.time('from');
const copy2 = Array.from(arr);
console.timeEnd('from'); // ~0.15ms

// æ–¹æ¡ˆ3: slice
console.time('slice');
const copy3 = arr.slice();
console.timeEnd('slice'); // ~0.05ms

// æ–¹æ¡ˆ4: concat
console.time('concat');
const copy4 = [].concat(arr);
console.timeEnd('concat'); // ~0.05ms

// ç»“è®º:å°æ•°æ®é‡å·®å¼‚ä¸å¤§,å¤§æ•°æ®é‡ slice/concat ç•¥å¿«
```

#### é¿å…è¿‡åº¦ä½¿ç”¨

```javascript
// âŒ é¿å…:å¾ªç¯ä¸­é¢‘ç¹åˆ›å»ºæ–°å¯¹è±¡
const result = [];
for (let i = 0; i < 1000; i++) {
  result.push({ ...obj, id: i }); // æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡
}

// âœ… ä¼˜åŒ–:åªåœ¨å¿…è¦æ—¶åˆ›å»º
const result = [];
for (let i = 0; i < 1000; i++) {
  if (needsNewObject) {
    result.push({ ...obj, id: i });
  } else {
    result.push(obj);
  }
}

// âŒ é¿å…:ä¸å¿…è¦çš„å±•å¼€
function process(...args) {
  return [...args]; // å¤šä½™,args æœ¬èº«å·²æ˜¯æ•°ç»„
}

// âœ… ç›´æ¥è¿”å›
function process(...args) {
  return args;
}
```

---

## å››ã€ç»¼åˆå®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: å®ç°ä¸å¯å˜æ•°æ®æ›´æ–°å·¥å…·

```javascript
// ç±»ä¼¼ Immer çš„ç®€åŒ–ç‰ˆ
class ImmerLite {
  produce(baseState, recipe) {
    const draft = this.createDraft(baseState);
    recipe(draft);
    return this.finalize(draft);
  }
  
  createDraft(obj) {
    if (typeof obj !== 'object' || obj === null) return obj;
    
    const draft = Array.isArray(obj) ? [...obj] : { ...obj };
    
    for (const key in draft) {
      draft[key] = this.createDraft(draft[key]);
    }
    
    return draft;
  }
  
  finalize(draft) {
    return draft;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const immer = new ImmerLite();
const state = {
  user: { name: 'Alice', age: 25 },
  todos: [{ id: 1, text: 'Learn', done: false }]
};

const newState = immer.produce(state, draft => {
  draft.user.age = 26;
  draft.todos[0].done = true;
  draft.todos.push({ id: 2, text: 'Practice', done: false });
});

console.log(state.user.age); // 25 (åŸå¯¹è±¡ä¸å˜)
console.log(newState.user.age); // 26
```

### æ¡ˆä¾‹ 2: å‡½æ•°ç»„åˆå·¥å…·

```javascript
// compose å’Œ pipe å®ç°
const compose = (...fns) => x => 
  fns.reduceRight((v, f) => f(v), x);

const pipe = (...fns) => x => 
  fns.reduce((v, f) => f(v), x);

// ä½¿ç”¨ç¤ºä¾‹
const add10 = x => x + 10;
const multiply2 = x => x * 2;
const subtract5 = x => x - 5;

const composed = compose(subtract5, multiply2, add10);
console.log(composed(5)); // (5+10)*2-5 = 25

const piped = pipe(add10, multiply2, subtract5);
console.log(piped(5)); // (5+10)*2-5 = 25

// å®æˆ˜:æ•°æ®å¤„ç†ç®¡é“
const processUser = pipe(
  user => ({ ...user, name: user.name.trim() }),
  user => ({ ...user, age: parseInt(user.age) }),
  user => ({ ...user, createdAt: new Date() })
);

const rawUser = { name: ' Alice ', age: '25' };
const processedUser = processUser(rawUser);
console.log(processedUser);
// { name: 'Alice', age: 25, createdAt: 2024-... }
```

### æ¡ˆä¾‹ 3: Redux-style Reducer

```javascript
// Action types
const ADD_TODO = 'ADD_TODO';
const TOGGLE_TODO = 'TOGGLE_TODO';
const UPDATE_USER = 'UPDATE_USER';

// Initial state
const initialState = {
  user: { name: '', email: '' },
  todos: []
};

// Reducer (ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ä¿è¯ä¸å¯å˜æ€§)
function rootReducer(state = initialState, action) {
  switch (action.type) {
    case ADD_TODO:
      return {
        ...state,
        todos: [
          ...state.todos,
          {
            id: Date.now(),
            text: action.payload,
            done: false
          }
        ]
      };
    
    case TOGGLE_TODO:
      return {
        ...state,
        todos: state.todos.map(todo =>
          todo.id === action.payload
            ? { ...todo, done: !todo.done }
            : todo
        )
      };
    
    case UPDATE_USER:
      return {
        ...state,
        user: {
          ...state.user,
          ...action.payload
        }
      };
    
    default:
      return state;
  }
}

// ä½¿ç”¨
let state = initialState;

state = rootReducer(state, { 
  type: ADD_TODO, 
  payload: 'Learn Redux' 
});

state = rootReducer(state, { 
  type: UPDATE_USER, 
  payload: { name: 'Alice', email: 'alice@example.com' } 
});

console.log(state);
```

### æ¡ˆä¾‹ 4: API è¯·æ±‚å°è£…

```javascript
// é€šç”¨è¯·æ±‚å‡½æ•°
async function request(url, options = {}) {
  // é»˜è®¤é…ç½®
  const defaults = {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json'
    },
    timeout: 5000
  };
  
  // åˆå¹¶é…ç½®
  const config = {
    ...defaults,
    ...options,
    headers: {
      ...defaults.headers,
      ...options.headers
    }
  };
  
  // è§£æ„é…ç½®
  const { timeout, ...fetchOptions } = config;
  
  // è¶…æ—¶æ§åˆ¶
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeout);
  
  try {
    const response = await fetch(url, {
      ...fetchOptions,
      signal: controller.signal
    });
    
    clearTimeout(timeoutId);
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    return await response.json();
  } catch (error) {
    if (error.name === 'AbortError') {
      throw new Error('Request timeout');
    }
    throw error;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
async function getUserData(userId, options) {
  const { 
    includeProfile = true, 
    includePosts = false,
    ...restOptions 
  } = options || {};
  
  const [user, profile, posts] = await Promise.all([
    request(`/api/users/${userId}`, restOptions),
    includeProfile 
      ? request(`/api/users/${userId}/profile`, restOptions) 
      : null,
    includePosts 
      ? request(`/api/users/${userId}/posts`, restOptions) 
      : null
  ]);
  
  return {
    ...user,
    ...(profile && { profile }),
    ...(posts && { posts })
  };
}
```

---

## äº”ã€é¢è¯•é«˜é¢‘é¢˜è§£æ

### é¢˜ç›® 1: ç®­å¤´å‡½æ•°çš„ this

```javascript
// é—®é¢˜:è¾“å‡ºæ˜¯ä»€ä¹ˆ?
const obj = {
  name: 'Object',
  regularFunc: function() {
    console.log('1:', this.name);
    
    setTimeout(function() {
      console.log('2:', this.name);
    }, 100);
    
    setTimeout(() => {
      console.log('3:', this.name);
    }, 100);
  },
  arrowFunc: () => {
    console.log('4:', this.name);
  }
};

obj.regularFunc();
obj.arrowFunc();

// ç­”æ¡ˆ:
// 1: Object (regularFunc çš„ this æ˜¯ obj)
// 4: undefined (arrowFunc çš„ this æ˜¯å®šä¹‰æ—¶çš„å¤–å±‚,é€šå¸¸æ˜¯ window)
// 2: undefined (setTimeout å›è°ƒçš„ this æ˜¯ window)
// 3: Object (ç®­å¤´å‡½æ•°æ•è· regularFunc çš„ this,å³ obj)
```

### é¢˜ç›® 2: è§£æ„èµ‹å€¼é»˜è®¤å€¼

```javascript
// é—®é¢˜:è¾“å‡ºæ˜¯ä»€ä¹ˆ?
const { a = 10, b = 5 } = { a: 3 };
console.log(a, b); // ?

const { x: { y = 10 } = {} } = { x: { y: 3 } };
console.log(y); // ?

const { z = 10 } = { z: undefined };
console.log(z); // ?

const { w = 10 } = { w: null };
console.log(w); // ?

// ç­”æ¡ˆ:
// 3 5 (a æœ‰å€¼ç”¨ 3,b æ— å€¼ç”¨é»˜è®¤ 5)
// 3 (y çš„å€¼æ˜¯ 3)
// 10 (undefined è§¦å‘é»˜è®¤å€¼)
// null (null ä¸è§¦å‘é»˜è®¤å€¼)
```

### é¢˜ç›® 3: æ‰©å±•è¿ç®—ç¬¦æµ…æ‹·è´

```javascript
// é—®é¢˜:ä¿®æ”¹ copy ä¼šå½±å“ original å—?
const original = {
  name: 'Alice',
  hobbies: ['reading', 'coding'],
  address: { city: 'Beijing' }
};

const copy = { ...original };

copy.name = 'Bob';
copy.hobbies.push('gaming');
copy.address.city = 'Shanghai';

console.log(original.name); // ?
console.log(original.hobbies); // ?
console.log(original.address.city); // ?

// ç­”æ¡ˆ:
// Alice (åŸºæœ¬ç±»å‹ä¸å—å½±å“)
// ['reading', 'coding', 'gaming'] (æ•°ç»„æ˜¯å¼•ç”¨,å—å½±å“)
// Shanghai (å¯¹è±¡æ˜¯å¼•ç”¨,å—å½±å“)
```

### é¢˜ç›® 4: æ•°ç»„è§£æ„äº¤æ¢

```javascript
// é—®é¢˜:ä¸ä½¿ç”¨ä¸´æ—¶å˜é‡äº¤æ¢ a å’Œ b
let a = 1, b = 2;

// ç­”æ¡ˆ
[a, b] = [b, a];
console.log(a, b); // 2 1

// åŸç†
// 1. [b, a] åˆ›å»ºä¸´æ—¶æ•°ç»„ [2, 1]
// 2. è§£æ„èµ‹å€¼ a = 2, b = 1
```

### é¢˜ç›® 5: Rest å‚æ•°ä¸ Arguments

```javascript
// é—®é¢˜:ä»¥ä¸‹ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜?
function sum(...args) {
  return arguments.reduce((a, b) => a + b);
}

// ç­”æ¡ˆ:
// é—®é¢˜:ç®­å¤´å‡½æ•°æ²¡æœ‰ arguments
// è§£å†³:
function sum(...args) {
  return args.reduce((a, b) => a + b);
}

// æˆ–è€…
function sum() {
  return Array.from(arguments).reduce((a, b) => a + b);
}
```

### é¢˜ç›® 6: å¯¹è±¡è§£æ„é‡å‘½å

```javascript
// é—®é¢˜:ä» user å¯¹è±¡ä¸­æå– name å¹¶é‡å‘½åä¸º userName
const user = { name: 'Alice', age: 25 };

// ç­”æ¡ˆ
const { name: userName } = user;
console.log(userName); // Alice
console.log(name); // ReferenceError (name æ˜¯å±æ€§å,ä¸æ˜¯å˜é‡)
```

### é¢˜ç›® 7: æ•°ç»„å±•å¼€ä¸ concat

```javascript
// é—®é¢˜:ä»¥ä¸‹ä¸¤ç§æ–¹å¼æœ‰åŒºåˆ«å—?
const arr1 = [1, 2, 3];
const arr2 = [4, 5, 6];

const result1 = [...arr1, ...arr2];
const result2 = arr1.concat(arr2);

// ç­”æ¡ˆ:
// ç»“æœç›¸åŒ,ä½†ç»†å¾®åŒºåˆ«:
// 1. å±•å¼€è¿ç®—ç¬¦æ›´çµæ´»(å¯ä»¥åœ¨ä»»æ„ä½ç½®æ’å…¥)
const result3 = [...arr1, 'middle', ...arr2];

// 2. concat ä¸ä¿®æ”¹åŸæ•°ç»„,å±•å¼€ä¹Ÿä¸ä¿®æ”¹
// 3. æ€§èƒ½ä¸Šå¤§æ•°æ®é‡ concat ç•¥å¿«
```

### é¢˜ç›® 8: æ·±åº¦è§£æ„é™·é˜±

```javascript
// é—®é¢˜:ä»¥ä¸‹ä»£ç ä¼šæŠ¥é”™å—?
const obj = {
  a: {
    b: {
      c: 1
    }
  }
};

const { a: { b: { c, d = 10 } } } = obj;
console.log(c, d); // ?

const { x: { y } } = obj; // ?

// ç­”æ¡ˆ:
// 1 10 (c å­˜åœ¨å€¼ä¸º 1,d ä¸å­˜åœ¨ç”¨é»˜è®¤å€¼)
// TypeError: Cannot destructure property 'y' of 'undefined' (x ä¸å­˜åœ¨)
```

### é¢˜ç›® 9: å®ç°å¯¹è±¡æ‰å¹³åŒ–

```javascript
// é—®é¢˜:å®ç° flatten å‡½æ•°
const nested = {
  a: 1,
  b: {
    c: 2,
    d: {
      e: 3
    }
  }
};

// ç›®æ ‡è¾“å‡º: { a: 1, 'b.c': 2, 'b.d.e': 3 }

// ç­”æ¡ˆ
function flatten(obj, prefix = '', result = {}) {
  for (const [key, value] of Object.entries(obj)) {
    const newKey = prefix ? `${prefix}.${key}` : key;
    
    if (typeof value === 'object' && value !== null) {
      flatten(value, newKey, result);
    } else {
      result[newKey] = value;
    }
  }
  
  return result;
}

console.log(flatten(nested));
```

### é¢˜ç›® 10: æ•°ç»„å»é‡(ä¿ç•™é¡ºåº)

```javascript
// é—®é¢˜:å®ç°æ•°ç»„å»é‡,ä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„å…ƒç´ 
const arr = [1, 2, 2, 3, 1, 4, 3];

// ç­”æ¡ˆ1: Set
const unique1 = [...new Set(arr)];

// ç­”æ¡ˆ2: filter
const unique2 = arr.filter((item, index) => arr.indexOf(item) === index);

// ç­”æ¡ˆ3: reduce
const unique3 = arr.reduce((acc, item) => 
  acc.includes(item) ? acc : [...acc, item], []
);

console.log(unique1); // [1, 2, 3, 4]

// å¯¹è±¡æ•°ç»„å»é‡
const users = [
  { id: 1, name: 'Alice' },
  { id: 2, name: 'Bob' },
  { id: 1, name: 'Alice' }
];

const uniqueUsers = [
  ...new Map(users.map(u => [u.id, u])).values()
];
```

---

## æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

#### ç®­å¤´å‡½æ•°
- **this è¯æ³•ç»‘å®š**: å®šä¹‰æ—¶æ•è·,æ— æ³•æ”¹å˜
- **æ²¡æœ‰ arguments/prototype/super**
- **ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°**
- **é€‚ç”¨åœºæ™¯**: å›è°ƒã€ä¸éœ€è¦åŠ¨æ€ this çš„å‡½æ•°

#### è§£æ„èµ‹å€¼
- **æ•°ç»„è§£æ„**: åŸºäº Iterator æ¥å£
- **å¯¹è±¡è§£æ„**: åŸºäºå±æ€§è®¿é—®
- **é»˜è®¤å€¼**: åªæœ‰ `undefined` è§¦å‘
- **é€‚ç”¨åœºæ™¯**: å‡½æ•°å‚æ•°ã€æå–æ•°æ®ã€å˜é‡äº¤æ¢

#### æ‰©å±•è¿ç®—ç¬¦
- **å±•å¼€**: åŸºäº Iterator(æ•°ç»„)/å±æ€§å¤åˆ¶(å¯¹è±¡)
- **å‰©ä½™**: æ”¶é›†å¤šä½™å‚æ•°/å±æ€§
- **æµ…æ‹·è´**: åªå¤åˆ¶ç¬¬ä¸€å±‚
- **é€‚ç”¨åœºæ™¯**: æ•°ç»„/å¯¹è±¡åˆå¹¶ã€å‡½æ•°å‚æ•°ã€ä¸å¯å˜æ›´æ–°

### æœ€ä½³å®è·µ

1. **ç®­å¤´å‡½æ•°**: ä¼˜å…ˆç”¨äºå›è°ƒ,é¿å…ç”¨ä½œå¯¹è±¡æ–¹æ³•
2. **è§£æ„**: æé«˜ä»£ç å¯è¯»æ€§,ä½†é¿å…è¿‡åº¦åµŒå¥—
3. **æ‰©å±•è¿ç®—ç¬¦**: ç®€åŒ–æ•°ç»„/å¯¹è±¡æ“ä½œ,æ³¨æ„æµ…æ‹·è´é™·é˜±
4. **æ€§èƒ½**: å°æ•°æ®é‡å·®å¼‚ä¸å¤§,å¤§æ•°æ®é‡è€ƒè™‘ä¼ ç»Ÿæ–¹æ³•
5. **å¯è¯»æ€§**: ç®€æ´ä¼˜å…ˆ,ä½†ä¸ç‰ºç‰²æ¸…æ™°åº¦

### è¿›é˜¶å­¦ä¹ 

- **TypeScript**: ç±»å‹æ ‡æ³¨å¢å¼ºå®‰å…¨æ€§
- **å‡½æ•°å¼ç¼–ç¨‹**: ç»“åˆ Ramda/Lodash-fp
- **ä¸å¯å˜æ•°æ®**: Immer/Immutable.js
- **æ€§èƒ½ä¼˜åŒ–**: å¤§æ•°æ®é‡åœºæ™¯çš„æ›¿ä»£æ–¹æ¡ˆ

---

**ç¥ä½ åœ¨é¢è¯•å’Œå·¥ä½œä¸­æ¸¸åˆƒæœ‰ä½™! ğŸš€**