
---
title: 2.2 - let/const/varåŒºåˆ«ã€æš‚æ—¶æ€§æ­»åŒº
aiNotebook: js-interview
date: 2026-02-02
tags: ['JavaScript', 'é¢è¯•']
excerpt: let/const/varåŒºåˆ«ã€æš‚æ—¶æ€§æ­»åŒº
order: 8
---

# JavaScript å˜é‡å£°æ˜æ·±åº¦è§£æï¼šlet/const/var ä¸æš‚æ—¶æ€§æ­»åŒº

> æ·±å…¥ç†è§£å˜é‡å£°æ˜çš„åº•å±‚åŸç†,ä»æ‰§è¡Œä¸Šä¸‹æ–‡åˆ°ä½œç”¨åŸŸé“¾çš„å®Œæ•´è§£æ

## ç›®å½•

- [æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ](#æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ)
- [var çš„åº•å±‚æœºåˆ¶](#var-çš„åº•å±‚æœºåˆ¶)
- [let/const çš„é©å‘½æ€§æ”¹å˜](#letconst-çš„é©å‘½æ€§æ”¹å˜)
- [æš‚æ—¶æ€§æ­»åŒº(TDZ)æ·±åº¦å‰–æ](#æš‚æ—¶æ€§æ­»åŒºtdzæ·±åº¦å‰–æ)
- [æ‰§è¡Œä¸Šä¸‹æ–‡ä¸å˜é‡ç¯å¢ƒ](#æ‰§è¡Œä¸Šä¸‹æ–‡ä¸å˜é‡ç¯å¢ƒ)
- [ä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾](#ä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾)
- [å®æˆ˜åœºæ™¯ä¸æœ€ä½³å®è·µ](#å®æˆ˜åœºæ™¯ä¸æœ€ä½³å®è·µ)
- [é¢è¯•é«˜é¢‘é—®é¢˜ç²¾è®²](#é¢è¯•é«˜é¢‘é—®é¢˜ç²¾è®²)

---

## æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ

### ä¸‰è€…å¯¹æ¯”è¡¨

| ç‰¹æ€§ | var | let | const |
|------|-----|-----|-------|
| ä½œç”¨åŸŸ | å‡½æ•°ä½œç”¨åŸŸ | å—çº§ä½œç”¨åŸŸ | å—çº§ä½œç”¨åŸŸ |
| å˜é‡æå‡ | æå‡å¹¶åˆå§‹åŒ–ä¸º undefined | æå‡ä½†ä¸åˆå§‹åŒ–(TDZ) | æå‡ä½†ä¸åˆå§‹åŒ–(TDZ) |
| é‡å¤å£°æ˜ | å…è®¸ | æŠ¥é”™ | æŠ¥é”™ |
| é‡æ–°èµ‹å€¼ | å…è®¸ | å…è®¸ | ä¸å…è®¸(å¯¹è±¡å±æ€§å¯ä¿®æ”¹) |
| å…¨å±€å¯¹è±¡å±æ€§ | æ˜¯ | å¦ | å¦ |
| æš‚æ—¶æ€§æ­»åŒº | æ—  | æœ‰ | æœ‰ |

---

## var çš„åº•å±‚æœºåˆ¶

### 1. å‡½æ•°ä½œç”¨åŸŸç‰¹æ€§

**var åªè®¤å‡½æ•°è¾¹ç•Œ,ä¸è®¤å—çº§è¾¹ç•Œ**

```javascript
function testVarScope() {
  console.log(a); // undefined (å˜é‡æå‡)
  
  if (true) {
    var a = 10;
    console.log(a); // 10
  }
  
  console.log(a); // 10 (if å—å¤–ä»å¯è®¿é—®)
  
  for (var i = 0; i < 3; i++) {
    setTimeout(() => console.log(i), 100);
  }
  // è¾“å‡ºä¸‰ä¸ª 3 (i åœ¨å‡½æ•°ä½œç”¨åŸŸå†…åªæœ‰ä¸€ä¸ª)
}
```

**åŸç†è§£æ:**
```javascript
// å¼•æ“å®é™…æ‰§è¡Œé¡ºåº(å˜é‡æå‡å)
function testVarScope() {
  var a; // æå‡åˆ°å‡½æ•°é¡¶éƒ¨,åˆå§‹åŒ–ä¸º undefined
  var i; // æå‡
  
  console.log(a); // undefined
  
  if (true) {
    a = 10; // èµ‹å€¼æ“ä½œ
    console.log(a);
  }
  
  console.log(a);
  
  for (i = 0; i < 3; i++) {
    setTimeout(() => console.log(i), 100);
  }
}
```

### 2. å˜é‡æå‡(Hoisting)æœºåˆ¶

**var çš„æå‡åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ:**

```javascript
console.log(typeof x); // undefined (ä¸æŠ¥é”™)
console.log(x);        // undefined (å·²å£°æ˜ä½†æœªèµ‹å€¼)

var x = 5;

console.log(x);        // 5
```

**æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºé˜¶æ®µçš„å¤„ç†:**

```javascript
// åˆ›å»ºé˜¶æ®µ(Creation Phase)
ExecutionContext = {
  VariableEnvironment: {
    x: undefined  // var å£°æ˜çš„å˜é‡è¢«æå‡å¹¶åˆå§‹åŒ–ä¸º undefined
  }
}

// æ‰§è¡Œé˜¶æ®µ(Execution Phase)
// console.log(x) -> è®¿é—® VariableEnvironment.x -> undefined
// x = 5 -> èµ‹å€¼æ“ä½œ
```

### 3. å…¨å±€å¯¹è±¡æ±¡æŸ“

```javascript
var globalVar = 'I am global';
console.log(window.globalVar); // 'I am global' (æµè§ˆå™¨ç¯å¢ƒ)

let blockVar = 'I am block';
console.log(window.blockVar); // undefined
```

**åŸç†:**
- `var` åœ¨å…¨å±€ä½œç”¨åŸŸå£°æ˜çš„å˜é‡ä¼šæˆä¸ºå…¨å±€å¯¹è±¡çš„å±æ€§
- `let/const` å£°æ˜çš„å˜é‡å­˜å‚¨åœ¨å£°æ˜å¼ç¯å¢ƒè®°å½•ä¸­,ä¸ä¼šæ±¡æŸ“å…¨å±€å¯¹è±¡

### 4. é‡å¤å£°æ˜ä¸æŠ¥é”™

```javascript
var a = 1;
var a = 2;  // ä¸æŠ¥é”™,åè€…è¦†ç›–å‰è€…
console.log(a); // 2

// å¼•æ“å¤„ç†
// ç¬¬ä¸€æ¬¡: var a; a = 1;
// ç¬¬äºŒæ¬¡: (å¿½ç•¥ var a,å› ä¸ºå·²å­˜åœ¨) a = 2;
```

---

## let/const çš„é©å‘½æ€§æ”¹å˜

### 1. å—çº§ä½œç”¨åŸŸçš„å®ç°åŸç†

**è¯æ³•ç¯å¢ƒ(Lexical Environment)çš„åˆ›å»º**

```javascript
function testBlockScope() {
  let x = 1;
  
  if (true) {
    let x = 2; // æ–°çš„è¯æ³•ç¯å¢ƒ
    console.log(x); // 2
  }
  
  console.log(x); // 1
}
```

**å†…éƒ¨ç»“æ„:**

```javascript
// å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡
FunctionExecutionContext = {
  LexicalEnvironment: {
    EnvironmentRecord: {
      x: 1  // å¤–å±‚ let x
    },
    outer: GlobalLexicalEnvironment
  }
}

// if å—æ‰§è¡Œæ—¶åˆ›å»ºæ–°çš„è¯æ³•ç¯å¢ƒ
BlockExecutionContext = {
  LexicalEnvironment: {
    EnvironmentRecord: {
      x: 2  // å†…å±‚ let x
    },
    outer: FunctionExecutionContext.LexicalEnvironment  // æŒ‡å‘å¤–å±‚
  }
}
```

### 2. ç»å…¸çš„ for å¾ªç¯é—®é¢˜

**var ç‰ˆæœ¬çš„é—®é¢˜:**

```javascript
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100);
}
// è¾“å‡º: 3, 3, 3

// åŸå› : åªæœ‰ä¸€ä¸ª i å˜é‡
FunctionScope = {
  i: 3  // å¾ªç¯ç»“æŸåçš„å€¼
}
// ä¸‰ä¸ªå›è°ƒå‡½æ•°éƒ½å¼•ç”¨åŒä¸€ä¸ª i
```

**let ç‰ˆæœ¬çš„è§£å†³:**

```javascript
for (let i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100);
}
// è¾“å‡º: 0, 1, 2

// åŸå› : æ¯æ¬¡è¿­ä»£åˆ›å»ºæ–°çš„è¯æ³•ç¯å¢ƒ
Iteration0: { i: 0 }
Iteration1: { i: 1 }
Iteration2: { i: 2 }
// æ¯ä¸ªå›è°ƒå‡½æ•°æ•è·å„è‡ªè¿­ä»£çš„ i
```

**è¯¦ç»†æœºåˆ¶:**

```javascript
// for (let i = 0; i < 3; i++) { ... }
// ç­‰ä»·äº:

{
  let i = 0;
  {
    // è¿­ä»£ 0
    let i_iteration = i; // åˆ›å»ºè¿­ä»£ä¸“ç”¨ç»‘å®š
    setTimeout(() => console.log(i_iteration), 100);
    i++;
  }
  {
    // è¿­ä»£ 1
    let i_iteration = i;
    setTimeout(() => console.log(i_iteration), 100);
    i++;
  }
  {
    // è¿­ä»£ 2
    let i_iteration = i;
    setTimeout(() => console.log(i_iteration), 100);
    i++;
  }
}
```

### 3. const çš„ä¸å¯å˜æ€§

**const é™åˆ¶çš„æ˜¯ç»‘å®š,ä¸æ˜¯å€¼**

```javascript
// âœ… åŸºæœ¬ç±»å‹ä¸å¯å˜
const num = 10;
num = 20; // TypeError: Assignment to constant variable

// âœ… å¯¹è±¡å±æ€§å¯å˜
const obj = { value: 10 };
obj.value = 20;  // å…è®¸
obj.newProp = 30; // å…è®¸
console.log(obj); // { value: 20, newProp: 30 }

// âŒ é‡æ–°èµ‹å€¼ä¸å…è®¸
obj = {}; // TypeError

// âœ… æ•°ç»„å…ƒç´ å¯å˜
const arr = [1, 2, 3];
arr.push(4);     // å…è®¸
arr[0] = 10;     // å…è®¸
console.log(arr); // [10, 2, 3, 4]

// âŒ é‡æ–°èµ‹å€¼ä¸å…è®¸
arr = []; // TypeError
```

**å†…å­˜ç»“æ„:**

```javascript
// const obj = { value: 10 };

Stack Memory:
  obj -> 0x1234 (å¸¸é‡å¼•ç”¨,ä¸å¯æ”¹å˜)

Heap Memory:
  0x1234: { value: 10 } (å¯¹è±¡å†…å®¹,å¯ä»¥æ”¹å˜)

// obj.value = 20;
// æ”¹å˜çš„æ˜¯å †å†…å­˜ä¸­çš„å†…å®¹,æ ˆä¸­çš„å¼•ç”¨ä¸å˜

// obj = {}; 
// å°è¯•æ”¹å˜æ ˆä¸­çš„å¼•ç”¨,const ä¸å…è®¸
```

**çœŸæ­£çš„ä¸å¯å˜å¯¹è±¡:**

```javascript
// ä½¿ç”¨ Object.freeze()
const obj = Object.freeze({ value: 10 });
obj.value = 20;  // ä¸¥æ ¼æ¨¡å¼ä¸‹æŠ¥é”™,éä¸¥æ ¼æ¨¡å¼é™é»˜å¤±è´¥
console.log(obj.value); // 10

// æ·±åº¦å†»ç»“
function deepFreeze(obj) {
  Object.freeze(obj);
  Object.values(obj).forEach(val => {
    if (typeof val === 'object' && val !== null) {
      deepFreeze(val);
    }
  });
  return obj;
}

const nested = deepFreeze({
  a: 1,
  b: { c: 2 }
});

nested.a = 10;     // æ— æ•ˆ
nested.b.c = 20;   // æ— æ•ˆ
```

---

## æš‚æ—¶æ€§æ­»åŒº(TDZ)æ·±åº¦å‰–æ

### 1. TDZ çš„å®šä¹‰ä¸æœ¬è´¨

**æš‚æ—¶æ€§æ­»åŒº(Temporal Dead Zone):**
ä»å—çº§ä½œç”¨åŸŸå¼€å§‹åˆ°å˜é‡å£°æ˜è¯­å¥ä¹‹é—´çš„åŒºåŸŸ,åœ¨æ­¤æœŸé—´è®¿é—®å˜é‡ä¼šæŠ¥é”™ã€‚

```javascript
console.log(a); // ReferenceError: Cannot access 'a' before initialization
let a = 10;

// TDZ èŒƒå›´:
{
  // TDZ å¼€å§‹
  console.log(x); // ReferenceError
  
  let x = 5; // TDZ ç»“æŸ
  
  console.log(x); // 5
}
```

### 2. TDZ çš„åº•å±‚åŸç†

**æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä¸‰ä¸ªé˜¶æ®µ:**

```javascript
// ç¤ºä¾‹ä»£ç 
function test() {
  console.log(a); // ReferenceError
  let a = 10;
}

// é˜¶æ®µ 1: åˆ›å»ºé˜¶æ®µ(Creation Phase)
ExecutionContext = {
  LexicalEnvironment: {
    EnvironmentRecord: {
      a: <uninitialized>  // let å˜é‡è¢«"æå‡"ä½†æœªåˆå§‹åŒ–
    }
  }
}

// é˜¶æ®µ 2: æ‰§è¡Œé˜¶æ®µ - TDZ
// è®¿é—® a -> çŠ¶æ€ä¸º <uninitialized> -> ReferenceError

// é˜¶æ®µ 3: æ‰§è¡Œé˜¶æ®µ - å£°æ˜å
// let a = 10 æ‰§è¡Œ -> a è¢«åˆå§‹åŒ–ä¸º 10
ExecutionContext = {
  LexicalEnvironment: {
    EnvironmentRecord: {
      a: 10  // ç°åœ¨å¯ä»¥æ­£å¸¸è®¿é—®
    }
  }
}
```

**ä¸‰ç§å˜é‡çŠ¶æ€:**

```javascript
// 1. undeclared (æœªå£°æ˜)
console.log(noExist); // ReferenceError: noExist is not defined

// 2. uninitialized (æœªåˆå§‹åŒ– - TDZ)
console.log(inTDZ); // ReferenceError: Cannot access 'inTDZ' before initialization
let inTDZ;

// 3. initialized (å·²åˆå§‹åŒ–)
let initialized = 10;
console.log(initialized); // 10
```

### 3. TDZ çš„å¤æ‚åœºæ™¯

**åœºæ™¯ 1: å‡½æ•°å‚æ•°é»˜è®¤å€¼**

```javascript
function test(a = b, b = 2) {
  console.log(a, b);
}

test(); // ReferenceError: Cannot access 'b' before initialization

// åŸå› :
// å‚æ•°ä»å·¦åˆ°å³åˆå§‹åŒ–
// 1. a = b (æ­¤æ—¶ b è¿˜åœ¨ TDZ ä¸­)
// 2. ReferenceError
```

**æ­£ç¡®å†™æ³•:**

```javascript
function test(b = 2, a = b) {
  console.log(a, b);
}

test(); // 2 2

// æ‰§è¡Œé¡ºåº:
// 1. b = 2 (b åˆå§‹åŒ–å®Œæˆ)
// 2. a = b (b å·²ç»å¯ä»¥è®¿é—®)
```

**åœºæ™¯ 2: typeof æ“ä½œç¬¦**

```javascript
// var æ—¶ä»£çš„å®‰å…¨æ£€æµ‹
console.log(typeof undeclaredVar); // "undefined" (ä¸æŠ¥é”™)

// let/const æ—¶ä»£çš„ TDZ é™·é˜±
console.log(typeof x); // ReferenceError: Cannot access 'x' before initialization
let x = 10;

// åŸå› :
// typeof åœ¨ TDZ ä¸­è®¿é—® let/const å˜é‡ä¼šæŠ¥é”™
// ä½†è®¿é—®å®Œå…¨æœªå£°æ˜çš„å˜é‡è¿”å› "undefined"
```

**åœºæ™¯ 3: é—­åŒ…ä¸­çš„ TDZ**

```javascript
function outer() {
  return function inner() {
    console.log(x); // ReferenceError
  };
  let x = 10;
}

outer()();

// åˆ†æ:
// inner å‡½æ•°åˆ›å»ºæ—¶,x å·²ç»åœ¨å¤–å±‚ä½œç”¨åŸŸçš„ç¯å¢ƒè®°å½•ä¸­
// ä½† inner æ‰§è¡Œæ—¶,x ä»åœ¨ TDZ ä¸­(å£°æ˜è¯­å¥è¿˜æœªæ‰§è¡Œ)
```

**åœºæ™¯ 4: ç±»ä¸­çš„ TDZ**

```javascript
class Example {
  // é™æ€å­—æ®µ
  static field1 = console.log(this.field2); // undefined
  static field2 = 10;
  
  // å®ä¾‹å­—æ®µ
  instanceField1 = this.method(); // ReferenceError
  
  method() {
    return this.instanceField2;
  }
  
  instanceField2 = 20;
}

// åŸå› :
// é™æ€å­—æ®µæŒ‰é¡ºåºåˆå§‹åŒ–,field2 åœ¨ field1 ä¹‹å
// å®ä¾‹å­—æ®µåˆå§‹åŒ–æ—¶,åé¢çš„å­—æ®µè¿˜åœ¨ TDZ ä¸­
```

### 4. TDZ çš„å®é™…æ„ä¹‰

**1. é˜²æ­¢å˜é‡æå‡å¸¦æ¥çš„é—®é¢˜**

```javascript
// var æ—¶ä»£çš„éšè”½ bug
function getPrice(quantity) {
  if (quantity > 0) {
    var discount = 0.1;
  }
  return quantity * (1 - discount); // discount å¯èƒ½æ˜¯ undefined
}

console.log(getPrice(5)); // NaN

// let/const æ—¶ä»£çš„æ˜ç¡®é”™è¯¯
function getPrice(quantity) {
  if (quantity > 0) {
    let discount = 0.1;
  }
  return quantity * (1 - discount); // ReferenceError: discount is not defined
}
```

**2. ä¿è¯ä»£ç æ‰§è¡Œçš„ç¡®å®šæ€§**

```javascript
let x = x + 1; // ReferenceError: Cannot access 'x' before initialization

// æ˜ç¡®é˜»æ­¢è‡ªå¼•ç”¨åˆå§‹åŒ–
// è€Œ var ä¼šå¯¼è‡´:
var y = y + 1; // y = undefined + 1 = NaN
```

---

## æ‰§è¡Œä¸Šä¸‹æ–‡ä¸å˜é‡ç¯å¢ƒ

### 1. æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç»„æˆ

```javascript
ExecutionContext = {
  // è¯æ³•ç¯å¢ƒ(let/const å˜é‡å­˜å‚¨åœ¨è¿™é‡Œ)
  LexicalEnvironment: {
    EnvironmentRecord: {
      Type: "Declarative",
      // let/const å£°æ˜
    },
    outer: <reference to parent lexical environment>
  },
  
  // å˜é‡ç¯å¢ƒ(var å˜é‡å­˜å‚¨åœ¨è¿™é‡Œ)
  VariableEnvironment: {
    EnvironmentRecord: {
      Type: "Declarative",
      // var å£°æ˜
    },
    outer: <reference to parent lexical environment>
  },
  
  // this ç»‘å®š
  ThisBinding: <value>
}
```

### 2. å®Œæ•´çš„å˜é‡æŸ¥æ‰¾è¿‡ç¨‹

```javascript
let global = 'global';

function outer() {
  let outerVar = 'outer';
  
  function inner() {
    let innerVar = 'inner';
    console.log(innerVar);  // æŸ¥æ‰¾è¿‡ç¨‹æ¼”ç¤º
    console.log(outerVar);
    console.log(global);
  }
  
  inner();
}

outer();
```

**æŸ¥æ‰¾é“¾:**

```javascript
// 1. æŸ¥æ‰¾ innerVar
InnerExecutionContext.LexicalEnvironment
  -> EnvironmentRecord.innerVar âœ“ æ‰¾åˆ°

// 2. æŸ¥æ‰¾ outerVar
InnerExecutionContext.LexicalEnvironment
  -> EnvironmentRecord.outerVar âœ— æœªæ‰¾åˆ°
  -> outer (å¤–å±‚å¼•ç”¨)
  -> OuterExecutionContext.LexicalEnvironment
  -> EnvironmentRecord.outerVar âœ“ æ‰¾åˆ°

// 3. æŸ¥æ‰¾ global
InnerExecutionContext.LexicalEnvironment
  -> ... (å‘å¤–å±‚æŸ¥æ‰¾)
  -> GlobalExecutionContext.LexicalEnvironment
  -> EnvironmentRecord.global âœ“ æ‰¾åˆ°
```

### 3. var ä¸ let/const çš„ç¯å¢ƒå·®å¼‚

```javascript
var varVariable = 'var';
let letVariable = 'let';

function test() {
  var varInFunction = 'var';
  let letInFunction = 'let';
}

// å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡
GlobalExecutionContext = {
  VariableEnvironment: {
    EnvironmentRecord: {
      varVariable: 'var'
    }
  },
  LexicalEnvironment: {
    EnvironmentRecord: {
      letVariable: 'let',
      test: <function>
    }
  }
}

// å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡
FunctionExecutionContext = {
  VariableEnvironment: {
    EnvironmentRecord: {
      varInFunction: 'var'
    }
  },
  LexicalEnvironment: {
    EnvironmentRecord: {
      letInFunction: 'let'
    }
  }
}
```

---

## ä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾

### 1. è¯æ³•ä½œç”¨åŸŸ(é™æ€ä½œç”¨åŸŸ)

**JavaScript é‡‡ç”¨è¯æ³•ä½œç”¨åŸŸ,åœ¨å‡½æ•°å®šä¹‰æ—¶ç¡®å®š,ä¸æ˜¯è¿è¡Œæ—¶ç¡®å®š**

```javascript
let value = 1;

function foo() {
  console.log(value);
}

function bar() {
  let value = 2;
  foo(); // è¾“å‡º 1,ä¸æ˜¯ 2
}

bar();

// åŸå› :
// foo å‡½æ•°åœ¨å…¨å±€ä½œç”¨åŸŸå®šä¹‰
// å…¶å¤–å±‚ä½œç”¨åŸŸ(outer reference)æŒ‡å‘å…¨å±€ä½œç”¨åŸŸ
// ä¸åœ¨å“ªé‡Œè°ƒç”¨æ— å…³
```

### 2. ä½œç”¨åŸŸé“¾çš„å½¢æˆ

```javascript
let a = 1;

function level1() {
  let b = 2;
  
  function level2() {
    let c = 3;
    
    function level3() {
      let d = 4;
      console.log(a, b, c, d); // 1 2 3 4
    }
    
    level3();
  }
  
  level2();
}

level1();
```

**ä½œç”¨åŸŸé“¾å›¾ç¤º:**

```
level3 ä½œç”¨åŸŸ
  â”œâ”€ d: 4
  â””â”€ outer -> level2 ä½œç”¨åŸŸ
              â”œâ”€ c: 3
              â””â”€ outer -> level1 ä½œç”¨åŸŸ
                          â”œâ”€ b: 2
                          â””â”€ outer -> å…¨å±€ä½œç”¨åŸŸ
                                      â””â”€ a: 1
```

### 3. é—­åŒ…ä¸ä½œç”¨åŸŸé“¾

```javascript
function createCounter() {
  let count = 0;
  
  return {
    increment() {
      count++;
      return count;
    },
    decrement() {
      count--;
      return count;
    },
    getCount() {
      return count;
    }
  };
}

const counter = createCounter();
console.log(counter.increment()); // 1
console.log(counter.increment()); // 2
console.log(counter.getCount());  // 2
```

**å†…å­˜ç»“æ„:**

```javascript
// createCounter æ‰§è¡Œå
Heap: {
  ClosureScope: {
    count: 0  // è¢«é—­åŒ…æ•è·,ä¸ä¼šè¢«åƒåœ¾å›æ”¶
  }
}

// è¿”å›çš„å¯¹è±¡
counter = {
  increment: <function>,  // [[Scope]] -> ClosureScope
  decrement: <function>,  // [[Scope]] -> ClosureScope
  getCount: <function>    // [[Scope]] -> ClosureScope
}

// ä¸‰ä¸ªæ–¹æ³•å…±äº«åŒä¸€ä¸ª ClosureScope
```

---

## å®æˆ˜åœºæ™¯ä¸æœ€ä½³å®è·µ

### 1. å¾ªç¯ä¸­çš„å¼‚æ­¥æ“ä½œ

**é—®é¢˜åœºæ™¯:**

```javascript
// âŒ å¸¸è§é”™è¯¯
for (var i = 0; i < 5; i++) {
  setTimeout(() => {
    console.log(i);
  }, i * 1000);
}
// è¾“å‡º: 5 5 5 5 5 (æ¯ç§’ä¸€ä¸ª)
```

**è§£å†³æ–¹æ¡ˆå¯¹æ¯”:**

```javascript
// âœ… æ–¹æ¡ˆ 1: ä½¿ç”¨ let
for (let i = 0; i < 5; i++) {
  setTimeout(() => {
    console.log(i);
  }, i * 1000);
}
// è¾“å‡º: 0 1 2 3 4 (æ¯ç§’ä¸€ä¸ª)

// âœ… æ–¹æ¡ˆ 2: IIFE é—­åŒ…
for (var i = 0; i < 5; i++) {
  (function(j) {
    setTimeout(() => {
      console.log(j);
    }, j * 1000);
  })(i);
}

// âœ… æ–¹æ¡ˆ 3: å‡½æ•°å‚æ•°
for (var i = 0; i < 5; i++) {
  setTimeout((j) => {
    console.log(j);
  }, i * 1000, i);
}

// âœ… æ–¹æ¡ˆ 4: bind æ–¹æ³•
for (var i = 0; i < 5; i++) {
  setTimeout(console.log.bind(null, i), i * 1000);
}
```

### 2. æ¨¡å—æ¨¡å¼çš„æ¼”è¿›

**var æ—¶ä»£çš„æ¨¡å—æ¨¡å¼:**

```javascript
var MyModule = (function() {
  var privateVar = 'private';
  
  function privateMethod() {
    return privateVar;
  }
  
  return {
    publicMethod: function() {
      return privateMethod();
    }
  };
})();
```

**let/const æ—¶ä»£çš„æ¨¡å—æ¨¡å¼:**

```javascript
// ES6 æ¨¡å—
// module.js
const privateVar = 'private';

function privateMethod() {
  return privateVar;
}

export function publicMethod() {
  return privateMethod();
}

// æˆ–ä½¿ç”¨å—çº§ä½œç”¨åŸŸ
{
  const moduleData = {
    privateVar: 'private'
  };
  
  window.MyModule = {
    publicMethod() {
      return moduleData.privateVar;
    }
  };
}
```

### 3. æ¡ä»¶å£°æ˜çš„æœ€ä½³å®è·µ

```javascript
// âŒ é¿å…æ¡ä»¶å£°æ˜ let/const
if (condition) {
  let x = 1; // åªåœ¨ if å—å†…æœ‰æ•ˆ
}
console.log(x); // ReferenceError

// âœ… æ­£ç¡®åšæ³•
let x;
if (condition) {
  x = 1;
} else {
  x = 2;
}
console.log(x); // å®‰å…¨è®¿é—®

// âœ… æˆ–ä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼
const x = condition ? 1 : 2;
```

### 4. å¾ªç¯ä¸­çš„å˜é‡å£°æ˜ä½ç½®

```javascript
// âŒ æ€§èƒ½è¾ƒå·®(æ¯æ¬¡è¿­ä»£éƒ½å£°æ˜)
for (let i = 0; i < 1000; i++) {
  let temp = i * 2; // æ¯æ¬¡è¿­ä»£åˆ›å»ºæ–°å˜é‡
  console.log(temp);
}

// âœ… ä¼˜åŒ–å
let temp;
for (let i = 0; i < 1000; i++) {
  temp = i * 2; // å¤ç”¨å˜é‡
  console.log(temp);
}

// æ³¨æ„: ç°ä»£ JS å¼•æ“ä¼šä¼˜åŒ–è¿™ç§æƒ…å†µ,å·®å¼‚å¾ˆå°
// ä½†åœ¨å¤§è§„æ¨¡æ•°æ®å¤„ç†æ—¶å€¼å¾—æ³¨æ„
```

### 5. const çš„æœ€ä½³å®è·µ

```javascript
// âœ… ä¼˜å…ˆä½¿ç”¨ const
const MAX_USERS = 100;
const API_URL = 'https://api.example.com';

// âœ… å¯¹è±¡å’Œæ•°ç»„ä¹Ÿç”¨ const
const config = {
  timeout: 3000,
  retries: 3
};

const items = [1, 2, 3];
items.push(4); // å…è®¸ä¿®æ”¹

// âœ… éœ€è¦çœŸæ­£ä¸å¯å˜æ—¶
const IMMUTABLE_CONFIG = Object.freeze({
  apiKey: 'xxx',
  apiSecret: 'yyy'
});

// âŒ é¿å…è¿‡åº¦ä½¿ç”¨ let
let unnecessary = 10; // å¦‚æœä¸ä¼šé‡æ–°èµ‹å€¼,åº”è¯¥ç”¨ const

// âœ… åªåœ¨éœ€è¦é‡æ–°èµ‹å€¼æ—¶ç”¨ let
let counter = 0;
counter++;
```

---

## é¢è¯•é«˜é¢‘é—®é¢˜ç²¾è®²

### Q1: varã€letã€const çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?

**æ ‡å‡†ç­”æ¡ˆæ¡†æ¶:**

```javascript
// 1. ä½œç”¨åŸŸ
{
  var a = 1;    // å‡½æ•°ä½œç”¨åŸŸ
  let b = 2;    // å—çº§ä½œç”¨åŸŸ
  const c = 3;  // å—çº§ä½œç”¨åŸŸ
}
console.log(a); // 1 (å¯è®¿é—®)
console.log(b); // ReferenceError
console.log(c); // ReferenceError

// 2. å˜é‡æå‡
console.log(x); // undefined
var x = 1;

console.log(y); // ReferenceError
let y = 2;

// 3. é‡å¤å£°æ˜
var m = 1;
var m = 2; // å…è®¸

let n = 1;
let n = 2; // SyntaxError

// 4. å…¨å±€å¯¹è±¡å±æ€§
var globalVar = 1;
console.log(window.globalVar); // 1

let globalLet = 2;
console.log(window.globalLet); // undefined

// 5. å¯å˜æ€§
let changeable = 1;
changeable = 2; // å…è®¸

const immutable = 1;
immutable = 2; // TypeError
```

**æ·±å…¥ç‚¹:**
- var çš„å˜é‡æå‡ä¼šå¯¼è‡´å˜é‡åœ¨å£°æ˜å‰å°±å¯ä»¥è®¿é—®(å€¼ä¸º undefined)
- let/const ä¹Ÿä¼šæå‡,ä½†å­˜åœ¨æš‚æ—¶æ€§æ­»åŒº,è®¿é—®ä¼šæŠ¥é”™
- const ä¿è¯çš„æ˜¯æ ˆå†…å­˜ä¸­çš„å€¼ä¸å˜,å¯¹äºå¼•ç”¨ç±»å‹,å †å†…å­˜çš„å†…å®¹å¯ä»¥æ”¹å˜

---

### Q2: ä»€ä¹ˆæ˜¯æš‚æ—¶æ€§æ­»åŒº(TDZ)?ä¸ºä»€ä¹ˆéœ€è¦å®ƒ?

**æ¦‚å¿µè§£é‡Š:**

```javascript
// TDZ ç¤ºä¾‹
{
  // TDZ å¼€å§‹
  console.log(x); // ReferenceError: Cannot access 'x' before initialization
  
  let x = 10; // TDZ ç»“æŸ
  
  console.log(x); // 10
}
```

**ä¸ºä»€ä¹ˆéœ€è¦ TDZ:**

```javascript
// 1. é˜²æ­¢å˜é‡æå‡å¸¦æ¥çš„é—®é¢˜
function getValue(condition) {
  if (condition) {
    return value; // å¸Œæœ›æŠ¥é”™,è€Œä¸æ˜¯è¿”å› undefined
  }
  let value = 10;
}

// 2. ä¿è¯åˆå§‹åŒ–é¡ºåº
let x = x + 1; // ReferenceError (è€Œä¸æ˜¯ NaN)

// 3. é…åˆ const çš„è¯­ä¹‰
const PI = 3.14159;
// å¦‚æœæ²¡æœ‰ TDZ,PI åœ¨å£°æ˜å‰å¯èƒ½è¢«è®¿é—®,è¿èƒŒ const çš„ä¸å¯å˜è¯­ä¹‰
```

---

### Q3: å¦‚ä½•ç†è§£"let/const ä¹Ÿä¼šæå‡"?

**å…³é”®ç‚¹:**

```javascript
// let/const ç¡®å®ä¼šæå‡
let x = 'outer';

function test() {
  console.log(x); // ReferenceError: Cannot access 'x' before initialization
  let x = 'inner';
}

test();

// å¦‚æœ let x ä¸æå‡,console.log(x) åº”è¯¥è®¿é—®å¤–å±‚çš„ 'outer'
// ä½†å®é™…æŠ¥é”™,è¯´æ˜å†…å±‚çš„ let x å·²ç»"æå‡"äº†,åªæ˜¯åœ¨ TDZ ä¸­
```

**æå‡çš„æœ¬è´¨:**

```javascript
// åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡æ—¶
ExecutionContext = {
  LexicalEnvironment: {
    EnvironmentRecord: {
      x: <uninitialized>  // å·²æå‡,ä½†çŠ¶æ€æ˜¯ uninitialized
    }
  }
}

// var çš„æå‡
VariableEnvironment: {
  EnvironmentRecord: {
    y: undefined  // å·²æå‡,ä¸”åˆå§‹åŒ–ä¸º undefined
  }
}
```

---

### Q4: ä¸ºä»€ä¹ˆ for å¾ªç¯ä¸­ let å’Œ var è¡¨ç°ä¸åŒ?

**è¯¦ç»†è§£æ:**

```javascript
// var ç‰ˆæœ¬
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100);
}
// è¾“å‡º: 3 3 3

// ç­‰ä»·äº:
var i;
for (i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100);
}
// åªæœ‰ä¸€ä¸ª i,æ‰€æœ‰å›è°ƒéƒ½å¼•ç”¨è¿™ä¸ª i
// å¾ªç¯ç»“æŸæ—¶ i = 3


// let ç‰ˆæœ¬
for (let i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100);
}
// è¾“å‡º: 0 1 2

// ç­‰ä»·äº:
{
  let i = 0;
  if (i < 3) {
    let _i = i; // æ¯æ¬¡è¿­ä»£åˆ›å»ºæ–°çš„ç»‘å®š
    setTimeout(() => console.log(_i), 100);
    i++;
  }
  if (i < 3) {
    let _i = i;
    setTimeout(() => console.log(_i), 100);
    i++;
  }
  if (i < 3) {
    let _i = i;
    setTimeout(() => console.log(_i), 100);
    i++;
  }
}
```

**è§„èŒƒè¯´æ˜:**
- for å¾ªç¯çš„ let å£°æ˜ä¼šåœ¨æ¯æ¬¡è¿­ä»£åˆ›å»ºæ–°çš„è¯æ³•ç¯å¢ƒ
- æ¯ä¸ªè¿­ä»£çš„å¾ªç¯å˜é‡éƒ½æ˜¯ç‹¬ç«‹çš„
- è¿™æ˜¯è§„èŒƒç‰¹åˆ«ä¸º let/const åœ¨å¾ªç¯ä¸­è®¾è®¡çš„è¡Œä¸º

---

### Q5: const å£°æ˜çš„å¯¹è±¡ä¸ºä»€ä¹ˆå¯ä»¥ä¿®æ”¹å±æ€§?

**å†…å­˜æ¨¡å‹è§£é‡Š:**

```javascript
const obj = { value: 1 };

// å†…å­˜ç»“æ„:
// Stack(æ ˆ):
//   obj -> 0x1234 (å†…å­˜åœ°å€,const é”å®šçš„æ˜¯è¿™ä¸ªåœ°å€)
//
// Heap(å †):
//   0x1234: { value: 1 } (å¯¹è±¡å†…å®¹,æ²¡æœ‰è¢« const é”å®š)

obj.value = 2;  // âœ… ä¿®æ”¹å †å†…å­˜ä¸­çš„å†…å®¹
console.log(obj); // { value: 2 }

obj = {};  // âŒ å°è¯•æ”¹å˜æ ˆä¸­çš„åœ°å€å¼•ç”¨
// TypeError: Assignment to constant variable
```

**å¦‚ä½•çœŸæ­£ä¸å¯å˜:**

```javascript
// 1. æµ…å±‚å†»ç»“
const obj = Object.freeze({ value: 1 });
obj.value = 2; // ä¸¥æ ¼æ¨¡å¼æŠ¥é”™,éä¸¥æ ¼æ¨¡å¼é™é»˜å¤±è´¥

// 2. æ·±å±‚å†»ç»“
function deepFreeze(obj) {
  Object.freeze(obj);
  
  Object.keys(obj).forEach(key => {
    if (typeof obj[key] === 'object' && obj[key] !== null) {
      deepFreeze(obj[key]);
    }
  });
  
  return obj;
}

const nested = deepFreeze({
  a: 1,
  b: { c: 2 }
});

// 3. ä½¿ç”¨ä¸å¯å˜æ•°æ®åº“(å¦‚ Immutable.js)
import { Map } from 'immutable';

const immutableMap = Map({ value: 1 });
const newMap = immutableMap.set('value', 2); // è¿”å›æ–°å¯¹è±¡
console.log(immutableMap.get('value')); // 1
console.log(newMap.get('value')); // 2
```

---

### Q6: è¯´è¯´ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾

**ä½œç”¨åŸŸå®šä¹‰:**

```javascript
// ä½œç”¨åŸŸ: å˜é‡å¯è®¿é—®çš„èŒƒå›´

// 1. å…¨å±€ä½œç”¨åŸŸ
let globalVar = 'global';

// 2. å‡½æ•°ä½œç”¨åŸŸ
function func() {
  var functionVar = 'function';
}

// 3. å—çº§ä½œç”¨åŸŸ
{
  let blockVar = 'block';
}

// 4. æ¨¡å—ä½œç”¨åŸŸ
// module.js
const moduleVar = 'module';
export { moduleVar };
```

**ä½œç”¨åŸŸé“¾:**

```javascript
let level0 = 'global';

function level1() {
  let level1Var = 'level1';
  
  function level2() {
    let level2Var = 'level2';
    
    function level3() {
      let level3Var = 'level3';
      
      // ä½œç”¨åŸŸé“¾æŸ¥æ‰¾é¡ºåº:
      console.log(level3Var); // 1. å½“å‰ä½œç”¨åŸŸ
      console.log(level2Var); // 2. level2 ä½œç”¨åŸŸ
      console.log(level1Var); // 3. level1 ä½œç”¨åŸŸ
      console.log(level0);    // 4. å…¨å±€ä½œç”¨åŸŸ
    }
    
    level3();
  }
  
  level2();
}

level1();
```

**æŸ¥æ‰¾æœºåˆ¶:**

```javascript
function outer() {
  let x = 1;
  
  function inner() {
    console.log(x); // å¦‚ä½•æŸ¥æ‰¾ x?
  }
  
  inner();
}

// 1. inner å‡½æ•°çš„ [[Scope]] å±æ€§åœ¨å®šä¹‰æ—¶ç¡®å®š
inner.[[Scope]] = [
  innerLexicalEnvironment,
  outerLexicalEnvironment,
  globalLexicalEnvironment
]

// 2. æ‰§è¡Œ console.log(x) æ—¶
// æ²¿ç€ä½œç”¨åŸŸé“¾æŸ¥æ‰¾:
// innerLexicalEnvironment.x -> æœªæ‰¾åˆ°
// outerLexicalEnvironment.x -> æ‰¾åˆ°,å€¼ä¸º 1
```

---

### Q7: å¦‚ä½•è§£é‡Šé—­åŒ…?

**é—­åŒ…å®šä¹‰:**
å‡½æ•°èƒ½å¤Ÿè®¿é—®å…¶è¯æ³•ä½œç”¨åŸŸå¤–çš„å˜é‡,å³ä½¿è¯¥å‡½æ•°åœ¨å…¶è¯æ³•ä½œç”¨åŸŸå¤–æ‰§è¡Œã€‚

```javascript
function createCounter() {
  let count = 0; // è¢«é—­åŒ…æ•è·
  
  return function() {
    count++;
    return count;
  };
}

const counter = createCounter();
console.log(counter()); // 1
console.log(counter()); // 2

// createCounter æ‰§è¡Œå®Œæ¯•å,æ­£å¸¸æƒ…å†µä¸‹ count åº”è¯¥è¢«å›æ”¶
// ä½†ç”±äºè¿”å›çš„å‡½æ•°æŒæœ‰å¯¹ count çš„å¼•ç”¨
// count è¢«ä¿å­˜åœ¨é—­åŒ…ä¸­,ä¸ä¼šè¢«åƒåœ¾å›æ”¶
```

**é—­åŒ…çš„å†…å­˜æ¨¡å‹:**

```javascript
function outer() {
  let outerVar = 'outer';
  let unused = 'unused'; // ä¸ä¼šè¢«æ•è·
  
  return function inner() {
    console.log(outerVar); // ä½¿ç”¨äº† outerVar
  };
}

const fn = outer();

// é—­åŒ…å†…å®¹(åªåŒ…å«è¢«ä½¿ç”¨çš„å˜é‡):
Closure(outer) = {
  outerVar: 'outer'
  // unused ä¸åœ¨é—­åŒ…ä¸­
}
```

**ç»å…¸é—­åŒ…é—®é¢˜:**

```javascript
// âŒ é—®é¢˜ä»£ç 
function createFunctions() {
  var result = [];
  
  for (var i = 0; i < 3; i++) {
    result[i] = function() {
      return i;
    };
  }
  
  return result;
}

const funcs = createFunctions();
console.log(funcs[0]()); // 3
console.log(funcs[1]()); // 3
console.log(funcs[2]()); // 3

// âœ… è§£å†³æ–¹æ¡ˆ 1: let
function createFunctions() {
  var result = [];
  
  for (let i = 0; i < 3; i++) {
    result[i] = function() {
      return i;
    };
  }
  
  return result;
}

// âœ… è§£å†³æ–¹æ¡ˆ 2: IIFE
function createFunctions() {
  var result = [];
  
  for (var i = 0; i < 3; i++) {
    result[i] = (function(j) {
      return function() {
        return j;
      };
    })(i);
  }
  
  return result;
}
```

---

### Q8: å®é™…é¡¹ç›®ä¸­å¦‚ä½•é€‰æ‹© var/let/const?

**æœ€ä½³å®è·µ:**

```javascript
// âŒ é¿å…ä½¿ç”¨ var
var oldStyle = 'avoid';

// âœ… é»˜è®¤ä½¿ç”¨ const
const API_KEY = 'xxx';
const config = { timeout: 3000 };
const users = [];

// âœ… åªåœ¨éœ€è¦é‡æ–°èµ‹å€¼æ—¶ä½¿ç”¨ let
let count = 0;
count++;

let result = null;
if (condition) {
  result = getValue();
}

// âœ… å¾ªç¯è®¡æ•°å™¨
for (let i = 0; i < 10; i++) {
  // ...
}

// âœ… å—çº§ä½œç”¨åŸŸä¸­çš„ä¸´æ—¶å˜é‡
{
  let temp = processData();
  useTemp(temp);
}
// temp åœ¨è¿™é‡Œä¸å¯è®¿é—®,é¿å…æ±¡æŸ“
```

**å›¢é˜Ÿè§„èŒƒå»ºè®®:**

```javascript
// ESLint é…ç½®
{
  "rules": {
    "no-var": "error",           // ç¦æ­¢ä½¿ç”¨ var
    "prefer-const": "error",     // ä¼˜å…ˆä½¿ç”¨ const
    "no-const-assign": "error"   // ç¦æ­¢ä¿®æ”¹ const å˜é‡
  }
}

// ä¼˜å…ˆçº§:
// const > let > var (æ°¸è¿œä¸ç”¨)
```

---

## æ€»ç»“ä¸è®°å¿†è¦ç‚¹

### æ ¸å¿ƒè®°å¿†ç‚¹

**1. ä¸‰è€…æœ¬è´¨å·®å¼‚**
```
var:     å‡½æ•°ä½œç”¨åŸŸ + æå‡å¹¶åˆå§‹åŒ–ä¸º undefined + å…è®¸é‡å¤å£°æ˜
let:     å—çº§ä½œç”¨åŸŸ + æå‡ä½†ä¸åˆå§‹åŒ–(TDZ) + ç¦æ­¢é‡å¤å£°æ˜
const:   å—çº§ä½œç”¨åŸŸ + æå‡ä½†ä¸åˆå§‹åŒ–(TDZ) + ç¦æ­¢é‡å¤å£°æ˜ + ç¦æ­¢é‡æ–°èµ‹å€¼
```

**2. å˜é‡æå‡æœºåˆ¶**
```javascript
// var: æå‡ + åˆå§‹åŒ–
var x; // undefined

// let/const: æå‡ + ä¸åˆå§‹åŒ–
let y; // <uninitialized> -> TDZ
```

**3. TDZ çš„æœ¬è´¨**
ä»ä½œç”¨åŸŸå¼€å§‹åˆ°å£°æ˜è¯­å¥ä¹‹é—´çš„åŒºåŸŸ,å˜é‡å¤„äº `<uninitialized>` çŠ¶æ€ã€‚

**4. for å¾ªç¯ç‰¹æ®Šæ€§**
let/const åœ¨ for å¾ªç¯ä¸­æ¯æ¬¡è¿­ä»£åˆ›å»ºæ–°çš„è¯æ³•ç¯å¢ƒã€‚

**5. const çš„ä¸å¯å˜**
é”å®šçš„æ˜¯æ ˆä¸­çš„å¼•ç”¨,ä¸æ˜¯å †ä¸­çš„å€¼ã€‚

---

## å®æˆ˜ç»ƒä¹ é¢˜

### ç»ƒä¹  1: é¢„æµ‹è¾“å‡º

```javascript
console.log(a); // ?
var a = 1;

console.log(b); // ?
let b = 2;

{
  console.log(c); // ?
  let c = 3;
}

for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 0);
}
// ?

for (let j = 0; j < 3; j++) {
  setTimeout(() => console.log(j), 0);
}
// ?
```

<details>
<summary>ç­”æ¡ˆ</summary>

```javascript
console.log(a); // undefined
var a = 1;

console.log(b); // ReferenceError
let b = 2;

{
  console.log(c); // ReferenceError (TDZ)
  let c = 3;
}

// è¾“å‡º: 3 3 3
// è¾“å‡º: 0 1 2
```
</details>

---

### ç»ƒä¹  2: æ‰¾å‡ºé”™è¯¯

```javascript
const obj = { value: 1 };
obj.value = 2;  // ?
obj = { value: 3 };  // ?

let x = 10;
let x = 20;  // ?

function test(a = b, b = 2) {
  console.log(a, b);
}
test();  // ?

typeof undeclared;  // ?
typeof uninitialized;  // ?
let uninitialized;
```

<details>
<summary>ç­”æ¡ˆ</summary>

```javascript
const obj = { value: 1 };
obj.value = 2;  // âœ… å…è®¸
obj = { value: 3 };  // âŒ TypeError

let x = 10;
let x = 20;  // âŒ SyntaxError

function test(a = b, b = 2) {
  console.log(a, b);
}
test();  // âŒ ReferenceError (b åœ¨ TDZ ä¸­)

typeof undeclared;  // âœ… "undefined"
typeof uninitialized;  // âŒ ReferenceError (TDZ)
let uninitialized;
```
</details>

---

### ç»ƒä¹  3: å®ç°é¢˜

å®ç°ä¸€ä¸ªå‡½æ•°,åˆ›å»ºå¤šä¸ªè®¡æ•°å™¨,æ¯ä¸ªè®¡æ•°å™¨ç‹¬ç«‹è®¡æ•°:

```javascript
function createCounters(n) {
  // å®ç°ä»£ç 
}

const counters = createCounters(3);
console.log(counters[0]()); // 1
console.log(counters[0]()); // 2
console.log(counters[1]()); // 1
console.log(counters[2]()); // 1
console.log(counters[0]()); // 3
```

<details>
<summary>ç­”æ¡ˆ</summary>

```javascript
function createCounters(n) {
  const result = [];
  
  for (let i = 0; i < n; i++) {
    let count = 0; // æ¯ä¸ªè®¡æ•°å™¨ç‹¬ç«‹çš„ count
    result.push(() => ++count);
  }
  
  return result;
}

// æˆ–ä½¿ç”¨é—­åŒ…
function createCounters(n) {
  return Array.from({ length: n }, () => {
    let count = 0;
    return () => ++count;
  });
}
```
</details>

---

## å»¶ä¼¸é˜…è¯»

1. **ECMAScript è§„èŒƒ**
   - [ECMAScriptÂ® 2024 Language Specification - Lexical Environments](https://tc39.es/ecma262/#sec-lexical-environments)

2. **æ·±å…¥æ–‡ç« **
   - [JavaScript Variables Lifecycle: Why let is not hoisted](https://dmitripavlutin.com/variables-lifecycle-and-why-let-is-not-hoisted/)
   - [Understanding Hoisting in JavaScript](https://www.digitalocean.com/community/tutorials/understanding-hoisting-in-javascript)

3. **V8 å¼•æ“å®ç°**
   - V8 å¦‚ä½•å®ç° TDZ
   - æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»ºè¿‡ç¨‹

---

**æ–‡æ¡£ç‰ˆæœ¬:** v1.0  
**æœ€åæ›´æ–°:** 2024  
**é€‚ç”¨äº:** ES6+ JavaScript å¼€å‘è€…

---

ç¥ä½ åœ¨é¢è¯•å’Œå·¥ä½œä¸­æ¸¸åˆƒæœ‰ä½™! ğŸš€ 